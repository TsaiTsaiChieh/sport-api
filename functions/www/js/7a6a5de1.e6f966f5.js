(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["7a6a5de1"],{"078c":function(e,t,s){},"28a6":function(e,t,s){"use strict";var i=s("aa3b"),a=s.n(i);a.a},3274:function(e,t,s){"use strict";var i=s("4565"),a=s.n(i);a.a},"3c7c":function(e,t,s){},"3ff5":function(e,t,s){"use strict";var i=s("c344"),a=s.n(i);a.a},4565:function(e,t,s){},"4c20":function(e,t,s){},"61a8":function(e,t,s){},"648e":function(e,t,s){},"64af":function(e,t,s){"use strict";var i=s("e3ec"),a=s.n(i);a.a},"686d":function(e,t,s){"use strict";var i=s("61a8"),a=s.n(i);a.a},"68e0":function(e,t,s){"use strict";var i=s("ad51"),a=s.n(i);a.a},"80d6":function(e,t,s){"use strict";var i=s("648e"),a=s.n(i);a.a},"821f":function(e,t,s){},"8b24":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",[s("home-chat")],1)},a=[],n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"fixed-bottom"},[s("chat-message-box"),s("chat-send-box")],1)},l=[],o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat-message page-padding non-selectable relative-position"},[s("q-virtual-scroll",{ref:"virtualListRef",staticClass:"chat-scroll-box",attrs:{items:e.computedMessages},on:{"virtual-scroll":e.handleScroll},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.item,a=t.index;return[i.isTime?s("chat-time",{attrs:{timestamp:i.timestamp}}):-1===i.deleteAction?s("div"):0===i.deleteAction?s("div",{staticClass:"text-center q-my-md"},[s("q-badge",{staticClass:"recycling"},[e._v("\n          已收回訊息\n        ")])],1):1===i.deleteAction?s("div"):i.isImg&&i.isSent?s("chat-sent-image",{staticClass:"q-pb-xs",class:{animated:e.computedReply.index===a,shake:e.computedReply.index===a},attrs:{"user-role":e.$store.state.user.profile.role,role:i.role,"killer-level":i.killerLevel,"killer-type":i.killerType,name:i.name,avatar:i.avatar,signature:i.signature,point:i.point,timestamp:i.timestamp,imgUrl:i.file,messageId:i.messageId},on:{reply:e.handleReply,handleOpenImgView:e.handleOpenImgView,deleteMessage:e.deleteMessage}}):i.isImg&&!i.isSent?s("chat-received-image",{staticClass:"q-pb-xs",class:{animated:e.computedReply.index===a,shake:e.computedReply.index===a},attrs:{uid:i.uid,"user-role":e.$store.state.user.profile.role,role:i.role,"killer-level":i.killerLevel,"killer-type":i.killerType,name:i.name,avatar:i.avatar,signature:i.signature,point:i.point,timestamp:i.timestamp,imgUrl:i.file,messageId:i.messageId,levels:i.levels},on:{reply:e.handleReply,handleOpenImgView:e.handleOpenImgView,deleteMessage:e.deleteMessage,handleMutedUser:e.handleMutedUser}}):i.isVideo&&i.isSent?s("chat-sent-video",{staticClass:"q-pb-xs",class:{animated:e.computedReply.index===a,shake:e.computedReply.index===a},attrs:{"user-role":e.$store.state.user.profile.role,role:i.role,"killer-level":i.killerLevel,"killer-type":i.killerType,name:i.name,avatar:i.avatar,signature:i.signature,point:i.point,timestamp:i.timestamp,videoUrl:i.file,messageId:i.messageId},on:{reply:e.handleReply,deleteMessage:e.deleteMessage}}):i.isVideo&&!i.isSent?s("chat-received-video",{staticClass:"q-pb-xs",class:{animated:e.computedReply.index===a,shake:e.computedReply.index===a},attrs:{uid:i.uid,"user-role":e.$store.state.user.profile.role,role:i.role,"killer-level":i.killerLevel,"killer-type":i.killerType,name:i.name,avatar:i.avatar,signature:i.signature,point:i.point,timestamp:i.timestamp,videoUrl:i.file,messageId:i.messageId,levels:i.levels},on:{reply:e.handleReply,deleteMessage:e.deleteMessage,handleMutedUser:e.handleMutedUser}}):i.isSent?s("chat-sent-text",{staticClass:"q-pb-xs",class:{animated:e.computedReply.index===a,shake:e.computedReply.index===a},attrs:{"user-role":e.$store.state.user.profile.role,role:i.role,"killer-level":i.killerLevel,"killer-type":i.killerType,name:i.name,avatar:i.avatar,signature:i.signature,point:i.point,text:i.text,timestamp:i.timestamp,messageId:i.messageId,reply:i.reply},on:{"copy-text":e.copyText,reply:e.handleReply,handleOpenImgView:e.handleOpenImgView,deleteMessage:e.deleteMessage}}):s("chat-received-text",{staticClass:"q-pb-xs",class:{animated:e.computedReply.index===a,shake:e.computedReply.index===a},attrs:{uid:i.uid,"user-role":e.$store.state.user.profile.role,role:i.role,"killer-level":i.killerLevel,"killer-type":i.killerType,name:i.name,avatar:i.avatar,signature:i.signature,point:i.point,text:i.text,timestamp:i.timestamp,messageId:i.messageId,reply:i.reply,levels:i.levels},on:{"copy-text":e.copyText,reply:e.handleReply,handleOpenImgView:e.handleOpenImgView,deleteMessage:e.deleteMessage,handleMutedUser:e.handleMutedUser}})]}}])}),s("div",{staticClass:"info-box"},[s("div",{staticClass:"text-right"},[e.isAutoScroll||e.tipText?e._e():s("q-btn",{staticClass:"chat-scroll-last-btn no-shadow",attrs:{icon:"arrow_downward"},on:{click:e.scrollToLast}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:e.tipText,expression:"tipText"}],staticClass:"tip-text-box q-px-sm q-py-xs row no-wrap page-padding",on:{click:e.scrollToLast}},[s("span",{staticClass:"text-weight-bold text-no-wrap q-mr-sm"},[e._v("\n        "+e._s(e.tipName)+"\n      ")]),s("span",{staticClass:"ellipsis"},[e._v("\n        "+e._s(e.tipText)+"\n      ")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:e.computedReply.name,expression:"computedReply.name"}],staticClass:"reply-box page-padding q-py-sm",on:{click:e.focusReplyMessage}},[e.computedReply.text?s("div",{staticClass:"row items-center"},[s("div",{staticClass:"q-mr-sm"},[s("img",{staticClass:"avatar",attrs:{src:e.computedReply.avatar,alt:""}})]),s("div",{staticClass:"q-mr-xs col"},[s("div",{staticClass:"name text-bold"},[e._v(e._s(e.computedReply.name))]),s("div",{staticClass:"text ellipsis"},[e._v(e._s(e.computedReply.text))])]),s("div",{staticClass:"self-start"},[s("q-icon",{staticClass:"cursor-pointer",attrs:{size:"20px",name:"close"},on:{click:function(t){return t.stopPropagation(),e.closeReplyBox(t)}}})],1)]):e._e(),e.computedReply.imgUrl?s("div",{staticClass:"row items-center"},[s("div",{staticClass:"q-mr-sm"},[s("img",{staticClass:"avatar",attrs:{src:e.computedReply.avatar,alt:""}})]),s("div",{staticClass:"q-mr-xs col"},[s("div",{staticClass:"name text-bold"},[e._v(e._s(e.computedReply.name))])]),s("div",{staticClass:"img-box q-mr-md"},[s("img",{staticClass:"q-mr-xs",staticStyle:{},attrs:{src:e.computedReply.imgUrl,alt:""}})]),s("div",{staticClass:"self-start"},[s("q-icon",{staticClass:"cursor-pointer",attrs:{size:"20px",name:"close"},on:{click:function(t){return t.stopPropagation(),e.closeReplyBox(t)}}})],1)]):e._e(),e.computedReply.videoUrl?s("div",{staticClass:"row items-center"},[s("div",{staticClass:"q-mr-sm"},[s("img",{staticClass:"avatar",attrs:{src:e.computedReply.avatar,alt:""}})]),s("div",{staticClass:"q-mr-xs col"},[s("div",{staticClass:"name text-bold"},[e._v(e._s(e.computedReply.name))])]),s("div",{staticClass:"video-box q-mr-md"},[s("video",{staticClass:"video",attrs:{src:e.computedReply.videoUrl}}),s("q-icon",{staticClass:"play-icon",attrs:{name:"play_circle_outline"}})],1),s("div",{staticClass:"self-start"},[s("q-icon",{staticClass:"cursor-pointer",attrs:{size:"20px",name:"close"},on:{click:function(t){return t.stopPropagation(),e.closeReplyBox(t)}}})],1)]):e._e()])]),s("textarea",{ref:"copyTextarea",staticClass:"copy-textarea"}),s("q-dialog",{attrs:{"full-height":"","full-width":""},on:{"before-hide":function(t){e.imgView.imgSize=100}},model:{value:e.imgView.isShow,callback:function(t){e.$set(e.imgView,"isShow",t)},expression:"imgView.isShow"}},[s("div",{staticClass:"no-shadow relative-position"},[s("img",{staticClass:"fixed-center",staticStyle:{margin:"0 auto"},attrs:{width:e.imgView.imgSize+"%",src:e.imgView.imgURL,alt:""}}),s("div",{staticClass:"q-px-md q-py-sm bg-blue-grey-9 row absolute-bottom"},[s("div",[s("q-btn",{staticClass:"q-mr-sm",attrs:{size:"sm",flat:"",round:"",color:"white",icon:"remove"},on:{click:function(t){e.imgView.imgSize=10===e.imgView.imgSize?10:e.imgView.imgSize-10}}}),s("q-btn",{attrs:{size:"sm",flat:"",round:"",color:"white",icon:"add"},on:{click:function(t){e.imgView.imgSize=200===e.imgView.imgSize?200:e.imgView.imgSize+10}}})],1),s("q-space"),s("div",[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{size:"sm",flat:"",round:"",color:"white",icon:"close"}})],1)],1)])])],1)},r=[],c=(s("7f7f"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat-time row items-center"},[s("div",{staticClass:"line col"}),s("span",{staticClass:"text q-px-lg q-py-xs q-mx-md"},[e._v("\n    "+e._s(e.computedTime)+"\n  ")]),s("div",{staticClass:"line col"})])}),p=[],m=(s("c5f6"),s("bd4c")),d={props:{timestamp:{type:Number}},data:function(){return{weeks:["日","一","二","三","四","五","六"]}},computed:{computedTime:function(){var e=m["b"].getDateDiff(new Date(this.timestamp),new Date,"days"),t=m["b"].formatDate(this.timestamp,"d");return 0===e?"今天":-1===e?"昨天":-2===e?"前天":m["b"].formatDate(this.timestamp,"MM月DD號 星期".concat(this.weeks[t]))}}},u=d,v=(s("c0a83"),s("2877")),g=Object(v["a"])(u,c,p,!1,null,"2648fd96",null),f=g.exports,h=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"row no-wrap",style:{fontSize:e.size}},[s("div",{staticClass:"q-mr-sm"},[s("img",{staticClass:"avatar",attrs:{src:e.avatar,alt:""},on:{click:function(t){e.isOpenProfileDialog=!0}}}),"admin"===e.$store.state.user.profile.role?s("app-dialog-edit-profile",{attrs:{uid:e.uid,name:e.name,avatar:e.avatar,signature:e.signature,point:e.point,levels:e.levels},model:{value:e.isOpenProfileDialog,callback:function(t){e.isOpenProfileDialog=t},expression:"isOpenProfileDialog"}}):e._e(),"admin"!==e.$store.state.user.profile.role?s("app-dialog-profile",{attrs:{name:e.name,avatar:e.avatar,signature:e.signature,point:e.point,levels:e.levels},model:{value:e.isOpenProfileDialog,callback:function(t){e.isOpenProfileDialog=t},expression:"isOpenProfileDialog"}}):e._e()],1),s("div",[s("div",{staticClass:"row items-center q-my-xs"},["killer"===e.role?s("span",{staticClass:"row items-center"},[e.killerLevel?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/killer-"+e.killerLevel+".png",alt:""}}):e._e(),e.killerType?s("span",{staticClass:"q-mr-xs"},[e._v("\n          "+e._s(e.killerType)+"\n        ")]):e._e()]):e._e(),"admin"===e.role?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/admin.png",alt:""}}):e._e(),s("span",{staticClass:"text-grey-6"},[e._v(e._s(e.name))])]),s("div",{staticClass:"row no-wrap items-center"},[s("div",{staticClass:"message q-mr-sm",class:{"is-reply":!!e.reply,"user-role":"user"===e.role,"admin-role":"admin"===e.role,"killer-role":"killer"===e.role}},[e.reply&&e.reply.messageId?s("div",{staticClass:"reply-box row q-pa-md"},[s("img",{staticClass:"avatar q-mr-sm",attrs:{src:e.reply.avatar,alt:""}}),s("div",{staticClass:"col q-mr-sm"},[s("div",{staticClass:"text-bold"},[e._v(e._s(e.reply.name))]),e.reply.text?s("div",{staticClass:"ellipsis-2-lines full-width"},[e._v(e._s(e.reply.text))]):e._e()]),s("div",{staticClass:"img-box"},[e.reply.imgUrl?s("img",{staticClass:"q-mr-xs",attrs:{src:e.reply.imgUrl,alt:""},on:{click:function(t){return e.$emit("handleOpenImgView",{imgURL:e.reply.imgUrl})}}}):e._e()]),e.reply.videoUrl?s("div",{staticClass:"video-box q-mr-xs"},[s("video",{staticClass:"video",attrs:{src:e.reply.videoUrl}}),s("q-icon",{staticClass:"play-icon",attrs:{name:"play_circle_outline"}})],1):e._e()]):e._e(),s("div",{staticClass:"text q-py-sm q-px-md text-pre"},[e._v(e._s(e.text))]),"user"===e.userRole||"killer"===e.userRole?s("q-menu",{attrs:{"touch-position":"","context-menu":""}},[s("q-list",{staticStyle:{"min-width":"100px"}},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[s("q-item-section",{on:{click:function(t){return e.handleReport({reportTarget:"content",avatar:e.avatar,name:e.name})}}},[e._v("\n                檢舉內文\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){e.isOpenReportDialog=!0}}},[s("q-item-section",{on:{click:function(t){return e.handleReport({reportTarget:"user",avatar:e.avatar,name:e.name})}}},[e._v("\n                檢舉玩家\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[s("q-item-section",{on:{click:function(t){return e.$emit("reply",{avatar:e.avatar,name:e.name,text:e.text,messageId:e.messageId})}}},[e._v("\n                回覆\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[s("q-item-section",{on:{click:function(t){return e.$emit("copy-text",{text:e.text})}}},[e._v("\n                複製\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:1})}}},[s("q-item-section",[e._v("\n                刪除\n              ")])],1)],1)],1):e._e(),"admin"===e.userRole?s("q-menu",{attrs:{"touch-position":"","context-menu":""}},[s("q-list",{staticStyle:{"min-width":"100px"}},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:-1})}}},[s("q-item-section",[e._v("\n                移除留言\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("handleMutedUser",{uid:e.uid})}}},[s("q-item-section",[e._v("\n                凍結玩家\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("reply",{avatar:e.avatar,name:e.name,text:e.text,messageId:e.messageId})}}},[s("q-item-section",[e._v("\n                回覆\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[s("q-item-section",{on:{click:function(t){return e.$emit("copy-text",{text:e.text})}}},[e._v("\n                複製\n              ")])],1)],1)],1):e._e()],1),s("div",{staticClass:"text-no-wrap text-grey-6"},[e._v("\n        "+e._s(e.computedTime)+"\n      ")])])]),s("app-dialog-report",{attrs:{uid:e.uid,"report-target":e.reportTarget,name:e.name,avatar:e.avatar},model:{value:e.isOpenReportDialog,callback:function(t){e.isOpenReportDialog=t},expression:"isOpenReportDialog"}}),s("app-dialog-point",{model:{value:e.isOpenPointDialog,callback:function(t){e.isOpenPointDialog=t},expression:"isOpenPointDialog"}})],1)},y=[],x=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-dialog",{ref:"dialog",on:{hide:function(t){return e.$emit("hide",!1)}}},[s("q-card",{staticClass:"card q-px-md"},[s("q-card-section",[s("div",{staticClass:"row justify-center items-center"},[s("div",{staticClass:"text-h5"},[e._v("\n          原因填寫\n        ")])])]),s("q-card-section",{staticClass:"q-px-md"},[s("q-form",{on:{submit:e.onSubmit}},[s("div",{staticClass:"row items-center q-mb-md"},[s("div",{staticClass:"report-label text-no-wrap q-px-sm q-py-xs radius-3 q-mr-md"},[e._v("\n            申訴對象\n          ")]),s("div",{staticClass:"row items-center no-wrap q-my-sm"},[s("img",{staticClass:"avatar q-mr-sm",attrs:{src:e.avatar,alt:""}}),s("span",{staticStyle:{"font-size":"16px","word-break":"break-all"}},[e._v(e._s(e.name))])])]),s("div",{staticClass:"row items-center q-mb-md"},[s("span",{staticClass:"report-label q-px-sm q-py-xs radius-3 q-mr-md"},[e._v("\n            申訴原因\n          ")]),s("div",[s("q-btn-dropdown",{staticClass:"select q-pl-md q-py-none q-my-sm",attrs:{dense:"",rounded:"",unelevated:"",label:e.selectReason||"原因選擇","dropdown-icon":"r_arrow_drop_down","content-style":"border-radius: 10px;margin-top: 3px;"}},[s("q-list",{staticClass:"menu"},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",active:"打廣告"===e.selectReason},on:{click:function(t){return e.onItemClick("打廣告")}}},[s("q-item-section",[e._v("打廣告")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",active:"內容不實"===e.selectReason},on:{click:function(t){return e.onItemClick("內容不實")}}},[s("q-item-section",[e._v("內容不實")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",active:"灌水洗版"===e.selectReason},on:{click:function(t){return e.onItemClick("灌水洗版")}}},[s("q-item-section",[e._v("灌水洗版")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",active:"人身攻擊"===e.selectReason},on:{click:function(t){return e.onItemClick("人身攻擊")}}},[s("q-item-section",[e._v("人身攻擊")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",active:"其他"===e.selectReason},on:{click:function(t){return e.onItemClick("其他")}}},[s("q-item-section",[e._v("其他")])],1)],1)],1)],1)]),s("div",{staticClass:"row no-wrap items-center q-mb-md"},[s("span",{staticClass:"report-label q-px-sm q-py-xs radius-3 q-mr-md text-no-wrap"},[e._v("\n            照片選擇\n          ")]),s("div",{staticClass:"col ellipsis"},[s("span",{staticClass:"file-name q-pl-sm"},[e._v(e._s(e.fileName||"請上傳照片"))])]),s("chat-upload-file",{staticClass:"upload q-ml-sm q-px-sm q-py-xs",attrs:{accept:"image/*",handleAddUploadFile:e.handleAddUploadFile}})],1),"其他"===this.selectReason?s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.reason,expression:"reason"}],staticClass:"reason radius-3 q-px-md q-py-sm q-mb-md",attrs:{rows:"10",placeholder:"請填寫申訴原因"},domProps:{value:e.reason},on:{input:function(t){t.target.composing||(e.reason=t.target.value)}}}):e._e(),s("div",{staticClass:"text-center"},[s("q-btn",{attrs:{label:"確認送出",type:"submit",color:"primary",disable:e.isSending}})],1)])],1)],1)],1)},q=[],b=(s("28a5"),s("1732")),C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("label",{staticClass:"btn btn-info cursor-pointer"},[s("input",{ref:"chatUploadImg",staticStyle:{display:"none"},attrs:{type:"file",capture:e.capture,accept:e.accept,multiple:e.multiple},on:{change:e.handleChange}}),s("q-icon",{staticClass:"text-white",attrs:{name:"photo",size:"sm"}})],1)},k=[],_={props:{capture:String,multiple:String,handleAddUploadFile:Function,accept:{type:String,default:"image/*,video/*"}},data:function(){return{maxFileNumber:9,uploadFileInput:null}},methods:{handleChange:function(){var e=this.$refs.chatUploadImg.files;if(e.length>this.maxFileNumber)this.$q.dialog({title:"上傳圖片提示",message:"You can upload maximum ".concat(this.maxFileNumber," files.")}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}));else{for(var t=0,s=e.length;t<s;t+=1)this.handleAddUploadFile({file:e[t]});this.$refs.chatUploadImg.value=null}}}},w=_,S=s("fe09"),$=Object(v["a"])(w,C,k,!1,null,"230f752f",null),I=$.exports;$.options.components=Object.assign({QIcon:S["n"]},$.options.components||{});var O={components:{ChatUploadFile:I},model:{prop:"isOpen",event:"hide"},props:{isOpen:Boolean,"report-target":{type:String},uid:{type:String},avatar:{type:String},name:{type:String}},data:function(){return{isSending:!1,fileName:"",fileUrl:"",selectReason:"",reason:""}},watch:{isOpen:function(e){e&&this.$refs.dialog.show()}},methods:{onItemClick:function(e){this.selectReason=e},onSubmit:function(){var e=this,t=this.uid,s=this.selectReason,i=this.fileUrl,a=this.reason;if(!this.isSending)if(0!==this.selectReason.trim().length&&""!==i){var n=s;"其他"===s&&(n=a),this.isSending=!0,this.$axiosInstance.post("/user/accuse",{defendant:t,reason:n,evidence:i}).then((function(){e.isSending=!1,e.$q.dialog({title:"提示",message:"檢舉玩家成功"}).onOk((function(){e.fileName="",e.fileUrl="",e.selectReason="",e.reason="",e.$refs.dialog.hide()})).onCancel((function(){})).onDismiss((function(){}))})).catch((function(){e.isSending=!1,e.$q.dialog({title:"提示",message:"檢舉玩家失敗"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}))}else this.$q.dialog({title:"送出提示",message:"請填入原因與上傳照片!"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))},handleAddUploadFile:function(e){var t=this,s=e.file;if(/^image/.test(s.type)){if(s.size>=4e6)return void this.$q.dialog({title:"上傳檔案",message:"上傳圖片 ".concat(s.name," 失敗，大小必須在 4 mb 以下")}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}));var i=this.$firebase.storage().ref(),a=(new Date).getTime()+Object(b["a"])(),n=s.type.split("/")[s.type.split("/").length-1],l=i.child("accuse_user/".concat(this.uid,"/").concat(a,".").concat(n));l.put(s).then((function(e){l.getDownloadURL().then((function(e){t.fileUrl=e}))}));var o=new FileReader;o.onload=function(e){t.fileName=s.name},o.readAsDataURL(s)}}}},R=O,T=(s("686d"),Object(v["a"])(R,x,q,!1,null,"1b61c04e",null)),N=T.exports;T.options.components=Object.assign({QDialog:S["j"],QCard:S["e"],QCardSection:S["f"],QForm:S["l"],QBtnDropdown:S["d"],QList:S["t"],QItem:S["p"],QItemSection:S["r"],QBtn:S["c"]},T.options.components||{}),T.options.directives=Object.assign({ClosePopup:S["a"]},T.options.directives||{});var D=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-dialog",{ref:"dialog",on:{hide:function(t){return e.$emit("hide",!1)}}},[s("q-card",{staticClass:"card m-card container"},[s("q-card-section",{staticClass:"q-px-lg q-my-lg"},[s("div",[s("div",{staticClass:"row items-center q-mb-lg"},[s("img",{staticClass:"avatar q-mr-sm",attrs:{src:e.avatar,alt:""}}),s("div",[s("div",{staticClass:"q-mt-sm",staticStyle:{"font-size":"16px"}},[e._v(e._s(e.name))]),s("div",{staticClass:"text-grey-6",staticStyle:{"font-size":"12px"}},[e._v(e._s(e.signature))]),s("div",{staticClass:"row items-center"},[s("img",{staticClass:"point-icon",attrs:{alt:"point img",src:"/statics/point.png"}}),s("span",{staticClass:"text-grey-6 q-mx-xs",staticStyle:{"font-size":"18px"}},[e._v(e._s(e.dataPoint))]),s("span",{staticStyle:{"font-size":"12px"}},[e._v("點")])])])]),0===e.dataLevels.length?s("div",{staticClass:"text-center text-bold",staticStyle:{"font-size":"18px"}},[e._v("無稱號")]):e._e(),s("div",[e._l(e.dataLevels,(function(t,i){return s("span",{key:"level-"+i,staticClass:"q-pr-sm"},[s("span",{staticClass:"self-level relative-position"},[s("img",{staticClass:"level-icon",attrs:{src:"/statics/chat/dialog/killer-"+t.level+".png",alt:""}}),s("span",{staticClass:"row items-center level-type q-pr-sm"},[s("span",{staticClass:"q-pl-lg"},[e._v(e._s(e.$store.state.user.rankMap[t.level]&&e.$store.state.user.rankMap[t.level].name)+" : ")]),s("span",{staticClass:"q-pr-xs q-py-xs"},[e._v(e._s(t.type)+" ")]),s("q-icon",{staticClass:"text-grey-7 cursor-pointer q-py-xs",attrs:{size:"20px",name:"close"},on:{click:function(t){return e.openDeleteLevel({index:i})}}})],1)])])})),s("div",{staticClass:"line q-my-md"})],2),s("div",[s("div",{staticClass:"text-bold text-center q-pb-md",staticStyle:{"font-size":"18px"}},[e._v("稱號選擇")]),s("div",{staticClass:"row items-center justify-between no-wrap m-select"},[s("span",[s("q-btn-dropdown",{staticClass:"select m-btn q-pl-sm q-mr-xs q-my-xs",attrs:{dense:"",rounded:"",unelevated:"","menu-anchor":"top left","menu-self":"bottom left",label:e.selectType||"球隊聯盟","dropdown-icon":"r_arrow_drop_down","content-style":"box-shadow: none;border-radius: 10px"}},[s("div",{staticClass:"menu q-px-md q-pb-sm"},e._l(e.$store.state.sport.sportMap,(function(t,i){return s("div",{key:"type-"+i},[s("div",{staticClass:"text-white q-py-sm",attrs:{size:"16px"}},[e._v(e._s(t.name))]),s("div",e._l(t.leagues,(function(i,a){return s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:"league-"+a,staticClass:"select-type q-py-none",class:{active:e.selectType===a},attrs:{dense:"",rounded:"",unelevated:"",label:i.name},on:{click:function(s){return e.onTypeClick({id:t.id,league:a})}}})})),1)])})),0)])],1),s("span",[s("q-btn-dropdown",{staticClass:"select q-pl-sm q-mr-xs q-my-xs",attrs:{dense:"",rounded:"",unelevated:"","menu-anchor":"top left","menu-self":"bottom left",label:e.levelName||"大神階級","dropdown-icon":"r_arrow_drop_down","content-style":"box-shadow: none;border-radius: 10px;"}},[s("q-list",{staticClass:"menu"},e._l(e.$store.state.user.rankMap,(function(t,i){return s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:"rank-"+i,staticClass:"select-level",attrs:{clickable:"",focused:e.levelName===t.name},on:{click:function(s){return e.onLevelClick(t.name,i)}}},[s("q-item-section",[e._v("\n                      "+e._s(t.name)+"\n                    ")])],1)})),1)],1)],1),s("span",{staticClass:"relative-position",on:{click:e.handleSubmit}},[s("q-btn",{staticClass:"btn",attrs:{dense:"",unelevated:""}}),s("q-icon",{staticClass:"send-icon cursor-pointer rotate-315",attrs:{name:"r_send"}})],1)]),s("div",{staticClass:"line q-my-lg"})]),s("div",{staticClass:"row items-center justify-between no-wrap m-point"},[s("img",{staticClass:"point-icon q-mr-sm",attrs:{alt:"point img",src:"/statics/point.png"}}),s("span",{staticClass:"text-bold q-mr-sm",staticStyle:{"font-size":"16px"}},[e._v("點數")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.addPoint,expression:"addPoint"}],staticClass:"input text-bold q-mr-sm q-px-sm",attrs:{type:"number",disable:e.isSendingPoint},domProps:{value:e.addPoint},on:{input:function(t){t.target.composing||(e.addPoint=t.target.value)}}}),s("q-btn",{staticClass:"gift q-px-md q-my-md",attrs:{dense:"",unelevated:"",label:"贈送",disable:e.isSendingPoint},on:{click:e.handlePoint}})],1)])])],1)],1)},U=[],L=s("4db1"),M=s.n(L),P={model:{prop:"isOpen",event:"hide"},props:{isOpen:Boolean,uid:String,avatar:{type:String},name:{type:String},signature:{type:String},point:{type:Number},levels:{type:Array}},data:function(){return{isSendingTitle:!1,isSendingPoint:!1,selectType:"",selectLevel:null,selectLeagueId:null,levelName:"",dataPoint:this.point,addPoint:0,dataLevels:M()(this.levels),isVisibleType:!1,isVisibleLevel:!1}},watch:{isOpen:function(e){e&&this.$refs.dialog.show()}},methods:{openDeleteLevel:function(e){var t=this,s=e.index;this.$q.dialog({title:"Alert",message:"確定要刪除嗎？",cancel:!0}).onOk((function(){t.dataLevels.splice(s,1)})).onCancel((function(){})).onDismiss((function(){}))},onTypeClick:function(e){var t=e.id,s=e.league;this.selectType=s,this.selectLeagueId=t},onLevelClick:function(e,t){this.levelName=e,this.selectLevel=t},handleSubmit:function(){var e=this;if(""===this.selectType||null===this.selectLevel)this.$q.dialog({title:"提示",message:"請選擇聯盟與階級！"}).onOk((function(){}));else{if(this.isSendingTitle)return;this.isSendingTitle=!0,this.$axiosInstance.post("/admin/giveTitle",{uid:this.uid,rank:this.selectLevel,league:this.selectType,sport:this.selectLeagueId}).then((function(){e.isSendingTitle=!1,e.dataLevels.push({level:e.selectLevel,type:e.selectType}),e.selectType="",e.selectLeagueId=null,e.levelName="",e.selectLevel=null})).catch((function(){e.$q.dialog({title:"提示",message:"新增稱號失敗"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){})),e.isSendingTitle=!1}))}},handlePoint:function(){var e=this;0!==parseInt(this.addPoint)?(this.isSendingPoint=!0,this.$axiosInstance.post("/admin/givePoints",{uid:this.uid,points:parseInt(this.addPoint)}).then((function(){e.isSendingPoint=!1,e.dataPoint+=parseInt(e.addPoint),e.addPoint=0})).catch((function(){e.isSendingPoint=!1}))):this.$q.dialog({title:"提示",message:"點數不可為 0"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}}},A=P,j=(s("fe2c"),Object(v["a"])(A,D,U,!1,null,"0a1b11bc",null)),Q=j.exports;j.options.components=Object.assign({QDialog:S["j"],QCard:S["e"],QCardSection:S["f"],QIcon:S["n"],QBtnDropdown:S["d"],QBtn:S["c"],QList:S["t"],QItem:S["p"],QItemSection:S["r"]},j.options.components||{}),j.options.directives=Object.assign({ClosePopup:S["a"]},j.options.directives||{});var z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-dialog",{ref:"dialog",on:{hide:function(t){return e.$emit("hide",!1)}}},[s("q-card",{staticClass:"card container"},[s("q-card-section",{staticClass:"q-px-xl q-py-lg"},[s("div",[s("div",{staticClass:"text-center q-my-xs"},[s("img",{staticClass:"avatar q-my-md",attrs:{src:e.avatar,alt:""}}),s("div",{staticStyle:{"font-size":"16px"}},[e._v(e._s(e.name))]),s("div",[s("span",{staticClass:"text-grey-6",staticStyle:{"font-size":"12px"}},[e._v("\n              "+e._s(e.signature)+"\n            ")])])]),s("div",{staticClass:"row justify-center"},[s("div",{staticClass:"box"},[s("div",{staticClass:"row items-center justify-center q-my-md"},[s("img",{staticClass:"point-icon",attrs:{alt:"point img",src:"/statics/point.png"}}),s("span",{staticClass:"text-bold text-red-10 q-mx-md",staticStyle:{"font-size":"18px"}},[e._v(e._s(e.point))]),s("span",[e._v("點")])]),0===e.levels.length?s("div",{staticClass:"text-center text-bold",staticStyle:{"font-size":"18px"}},[e._v("無稱號")]):e._e(),e._l(e.levels,(function(t,i){return s("div",{key:"level-"+i,staticClass:"q-mb-sm"},[s("span",{staticClass:"level relative-position"},[s("img",{staticClass:"level-icon",attrs:{src:"/statics/chat/dialog/killer-"+t.level+".png",alt:""}}),s("span",{staticClass:"row items-center level-type q-pr-sm"},[s("span",{staticClass:"q-pl-lg"},[e._v(e._s(e.$store.state.user.rankMap[t.level]&&e.$store.state.user.rankMap[t.level].name)+" : ")]),s("span",{staticClass:"q-pr-xs q-py-xs"},[e._v(e._s(t.type)+" ")])])])])}))],2)])])])],1)],1)},V=[],B={model:{prop:"isOpen",event:"hide"},props:{isOpen:Boolean,avatar:{type:String},name:{type:String},signature:{type:String},point:{type:Number},levels:{type:Array}},watch:{isOpen:function(e){e&&this.$refs.dialog.show()}}},F=B,E=(s("68e0"),Object(v["a"])(F,z,V,!1,null,"229333a9",null)),H=E.exports;E.options.components=Object.assign({QDialog:S["j"],QCard:S["e"],QCardSection:S["f"]},E.options.components||{});var J=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-dialog",{ref:"dialog",on:{hide:function(t){return e.$emit("hide",!1)}}},[s("q-card",{staticClass:"card container relative-position"},[s("q-card-section",{staticClass:"q-px-xl q-py-lg"},[s("div",{staticClass:"bg"},[s("img",{staticClass:"ribbon-1",attrs:{src:"/statics/ribbon-1.png",alt:""}}),s("img",{staticClass:"ribbon-2",attrs:{src:"/statics/ribbon-2.png",alt:""}})]),s("div",{staticClass:"title text-bold text-white"},[e._v("\n        邀請代碼活動\n      ")]),s("div",{staticClass:"point-text row items-end text-bold"},[s("span",[e._v("獲得")]),s("span",{staticClass:"point q-mx-md"},[e._v(e._s(e.point))]),s("span",[e._v("點數")])])])],1)],1)},Y=[],G={model:{prop:"isOpen",event:"hide"},props:{isOpen:Boolean,point:{type:Number,default:200}},watch:{isOpen:function(e){e&&this.$refs.dialog.show()}}},K=G,W=(s("c950"),Object(v["a"])(K,J,Y,!1,null,"1615ba90",null)),X=W.exports;W.options.components=Object.assign({QDialog:S["j"],QCard:S["e"],QCardSection:S["f"]},W.options.components||{});var Z={props:{uid:{type:String},size:{type:String,default:"14px"},avatar:String,signature:String,point:Number,text:String,role:{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},"killer-level":{type:Number},"killer-type":{type:String},"user-role":{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},name:{type:String},timestamp:{type:Number},messageId:{type:String},reply:{type:Object},levels:{type:Array}},components:{AppDialogReport:N,AppDialogEditProfile:Q,AppDialogProfile:H,AppDialogPoint:X},data:function(){return{isOpenReportDialog:!1,isOpenProfileDialog:!1,isOpenPointDialog:!1,reportTarget:""}},computed:{computedTime:function(){var e=m["b"].formatDate(this.timestamp,"A hh:mm");return e}},methods:{handleReport:function(e){var t=this,s=e.reportTarget;e.avatar,e.name;"user"!==s?this.$q.dialog({title:"提示",message:"確定要檢舉 ".concat(this.name," 的內文嗎 ?"),cancel:!0,persistent:!0}).onOk((function(){t.$axiosInstance.post("/messages/accuse",{channelId:"public",messageId:t.messageId}).then((function(){t.$q.dialog({title:"提示",message:"檢舉內文成功"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))})).catch((function(){t.$q.dialog({title:"提示",message:"檢舉內文失敗"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}))})).onOk((function(){})).onCancel((function(){})).onDismiss((function(){})):this.reportTarget=s}}},ee=Z,te=(s("deb6"),Object(v["a"])(ee,h,y,!1,null,"c5d3f328",null)),se=te.exports;te.options.components=Object.assign({QIcon:S["n"],QMenu:S["u"],QList:S["t"],QItem:S["p"],QItemSection:S["r"]},te.options.components||{}),te.options.directives=Object.assign({ClosePopup:S["a"]},te.options.directives||{});var ie=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"row no-wrap",style:{fontSize:e.size}},[s("div",{staticClass:"q-mr-sm"},[s("img",{staticClass:"avatar",attrs:{src:e.avatar,alt:""},on:{click:function(t){e.isOpenProfileDialog=!0}}}),"admin"===e.$store.state.user.profile.role?s("app-dialog-edit-profile",{attrs:{uid:e.uid,name:e.name,avatar:e.avatar,signature:e.signature,point:e.point,levels:e.levels},model:{value:e.isOpenProfileDialog,callback:function(t){e.isOpenProfileDialog=t},expression:"isOpenProfileDialog"}}):e._e(),"admin"!==e.$store.state.user.profile.role?s("app-dialog-profile",{attrs:{name:e.name,avatar:e.avatar,signature:e.signature,point:e.point,levels:e.levels},model:{value:e.isOpenProfileDialog,callback:function(t){e.isOpenProfileDialog=t},expression:"isOpenProfileDialog"}}):e._e()],1),s("div",[s("div",{staticClass:"row items-center q-my-xs"},["killer"===e.role?s("span",{staticClass:"row items-center"},[e.killerLevel?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/killer-"+e.killerLevel+".png",alt:""}}):e._e(),e.killerType?s("span",{staticClass:"q-mr-xs"},[e._v("\n          "+e._s(e.killerType)+"\n        ")]):e._e()]):e._e(),"admin"===e.role?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/admin.png",alt:""}}):e._e(),s("span",{staticClass:"text-grey-6"},[e._v(e._s(e.name))])]),s("div",{staticClass:"row no-wrap items-center"},[s("div",{staticClass:"text q-mr-sm q-px-md q-py-sm",class:{"user-role":"user"===e.role,"admin-role":"admin"===e.role,"killer-role":"killer"===e.role}},[s("img",{staticClass:"img",attrs:{src:e.imgUrl,alt:""},on:{click:function(t){return e.$emit("handleOpenImgView",{imgURL:e.imgUrl})}}}),"user"===e.userRole||"killer"===e.userRole?s("q-menu",{attrs:{"touch-position":"","context-menu":""}},[s("q-list",{staticStyle:{"min-width":"100px"}},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[s("q-item-section",{on:{click:function(t){return e.handleReport({reportTarget:"content",avatar:e.avatar,name:e.name})}}},[e._v("\n                檢舉內文\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){e.isOpenReportDialog=!0}}},[s("q-item-section",{on:{click:function(t){return e.handleReport({reportTarget:"user",avatar:e.avatar,name:e.name})}}},[e._v("\n                檢舉玩家\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("reply",{avatar:e.avatar,name:e.name,imgUrl:e.imgUrl,messageId:e.messageId})}}},[s("q-item-section",[e._v("\n                回覆\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:1})}}},[s("q-item-section",[e._v("\n                刪除\n              ")])],1)],1)],1):e._e(),"admin"===e.userRole?s("q-menu",{attrs:{"touch-position":"","context-menu":""}},[s("q-list",{staticStyle:{"min-width":"100px"}},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:-1})}}},[s("q-item-section",[e._v("\n                移除留言\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("handleMutedUser",{uid:e.uid})}}},[s("q-item-section",[e._v("\n                凍結玩家\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("reply",{avatar:e.avatar,name:e.name,imgUrl:e.imgUrl,messageId:e.messageId})}}},[s("q-item-section",[e._v("\n                回覆\n              ")])],1)],1)],1):e._e()],1),s("div",{staticClass:"text-no-wrap text-grey-6"},[e._v("\n        "+e._s(e.computedTime)+"\n      ")])])]),s("app-dialog-report",{attrs:{uid:e.uid,"report-target":e.reportTarget,name:e.name,avatar:e.avatar},model:{value:e.isOpenReportDialog,callback:function(t){e.isOpenReportDialog=t},expression:"isOpenReportDialog"}})],1)},ae=[],ne={props:{uid:{type:String},size:{type:String,default:"14px"},avatar:String,signature:String,point:Number,imgUrl:String,role:{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},"killer-level":{type:Number},"killer-type":{type:String},"user-role":{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},name:{type:String},timestamp:{type:Number},messageId:{type:String},levels:{type:Array}},components:{AppDialogReport:N,AppDialogEditProfile:Q,AppDialogProfile:H},data:function(){return{isOpenReportDialog:!1,isOpenProfileDialog:!1,reportTarget:""}},computed:{computedTime:function(){var e=m["b"].formatDate(this.timestamp,"A hh:mm");return e}},methods:{handleReport:function(e){var t=this,s=e.reportTarget;e.avatar,e.name;"user"!==s?this.$q.dialog({title:"提示",message:"確定要檢舉 ".concat(this.name," 的內文嗎 ?"),cancel:!0,persistent:!0}).onOk((function(){t.$axiosInstance.post("/messages/accuse",{channelId:"public",messageId:t.messageId}).then((function(){t.$q.dialog({title:"提示",message:"檢舉內文成功"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))})).catch((function(){t.$q.dialog({title:"提示",message:"檢舉內文失敗"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}))})).onOk((function(){})).onCancel((function(){})).onDismiss((function(){})):this.reportTarget=s}}},le=ne,oe=(s("c156"),Object(v["a"])(le,ie,ae,!1,null,"8ebecd62",null)),re=oe.exports;oe.options.components=Object.assign({QMenu:S["u"],QList:S["t"],QItem:S["p"],QItemSection:S["r"]},oe.options.components||{}),oe.options.directives=Object.assign({ClosePopup:S["a"]},oe.options.directives||{});var ce=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"row no-wrap",style:{fontSize:e.size}},[s("div",{staticClass:"q-mr-sm"},[s("img",{staticClass:"avatar",attrs:{src:e.avatar,alt:""},on:{click:function(t){e.isOpenProfileDialog=!0}}}),"admin"===e.$store.state.user.profile.role?s("app-dialog-edit-profile",{attrs:{uid:e.uid,name:e.name,avatar:e.avatar,signature:e.signature,point:e.point,levels:e.levels},model:{value:e.isOpenProfileDialog,callback:function(t){e.isOpenProfileDialog=t},expression:"isOpenProfileDialog"}}):e._e(),"admin"!==e.$store.state.user.profile.role?s("app-dialog-profile",{attrs:{name:e.name,avatar:e.avatar,signature:e.signature,point:e.point,levels:e.levels},model:{value:e.isOpenProfileDialog,callback:function(t){e.isOpenProfileDialog=t},expression:"isOpenProfileDialog"}}):e._e()],1),s("div",[s("div",{staticClass:"row items-center q-my-xs"},["killer"===e.role?s("span",{staticClass:"row items-center"},[e.killerLevel?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/killer-"+e.killerLevel+".png",alt:""}}):e._e(),e.killerType?s("span",{staticClass:"q-mr-xs"},[e._v("\n          "+e._s(e.killerType)+"\n        ")]):e._e()]):e._e(),"admin"===e.role?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/admin.png",alt:""}}):e._e(),s("span",{staticClass:"text-grey-6"},[e._v(e._s(e.name))])]),s("div",{staticClass:"row no-wrap items-center"},[s("div",{staticClass:"text q-mr-sm q-px-md q-py-sm",class:{"user-role":"user"===e.role,"admin-role":"admin"===e.role,"killer-role":"killer"===e.role}},[s("video",{staticClass:"video",attrs:{src:e.videoUrl,controls:""}}),"user"===e.userRole||"killer"===e.userRole?s("q-menu",{attrs:{"touch-position":"","context-menu":""}},[s("q-list",{staticStyle:{"min-width":"100px"}},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[s("q-item-section",{on:{click:function(t){return e.handleReport({reportTarget:"content",avatar:e.avatar,name:e.name})}}},[e._v("\n                檢舉內文\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){e.isOpenReportDialog=!0}}},[s("q-item-section",{on:{click:function(t){return e.handleReport({reportTarget:"user",avatar:e.avatar,name:e.name})}}},[e._v("\n                檢舉玩家\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("reply",{avatar:e.avatar,name:e.name,videoUrl:e.videoUrl,messageId:e.messageId})}}},[s("q-item-section",[e._v("\n                回覆\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:1})}}},[s("q-item-section",[e._v("\n                刪除\n              ")])],1)],1)],1):e._e(),"admin"===e.userRole?s("q-menu",{attrs:{"touch-position":"","context-menu":""}},[s("q-list",{staticStyle:{"min-width":"100px"}},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:-1})}}},[s("q-item-section",[e._v("\n                移除留言\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("handleMutedUser",{uid:e.uid})}}},[s("q-item-section",[e._v("\n                凍結玩家\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("reply",{avatar:e.avatar,name:e.name,videoUrl:e.videoUrl,messageId:e.messageId})}}},[s("q-item-section",[e._v("\n                回覆\n              ")])],1)],1)],1):e._e()],1),s("div",{staticClass:"text-no-wrap text-grey-6"},[e._v("\n        "+e._s(e.computedTime)+"\n      ")])])]),s("app-dialog-report",{attrs:{uid:e.uid,"report-target":e.reportTarget,name:e.name,avatar:e.avatar},model:{value:e.isOpenReportDialog,callback:function(t){e.isOpenReportDialog=t},expression:"isOpenReportDialog"}})],1)},pe=[],me={props:{uid:{type:String},size:{type:String,default:"14px"},avatar:String,signature:String,point:Number,videoUrl:String,role:{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},"killer-level":{type:Number},"killer-type":{type:String},"user-role":{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},name:{type:String},timestamp:{type:Number},messageId:{type:String},levels:{type:Array}},components:{AppDialogReport:N,AppDialogEditProfile:Q,AppDialogProfile:H},data:function(){return{isOpenReportDialog:!1,isOpenProfileDialog:!1,reportTarget:""}},computed:{computedTime:function(){var e=m["b"].formatDate(this.timestamp,"A hh:mm");return e}},methods:{handleReport:function(e){var t=this,s=e.reportTarget;e.avatar,e.name;"user"!==s?this.$q.dialog({title:"提示",message:"確定要檢舉 ".concat(this.name," 的內文嗎 ?"),cancel:!0,persistent:!0}).onOk((function(){t.$axiosInstance.post("/messages/accuse",{channelId:"public",messageId:t.messageId}).then((function(){t.$q.dialog({title:"提示",message:"檢舉內文成功"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))})).catch((function(){t.$q.dialog({title:"提示",message:"檢舉內文失敗"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}))})).onOk((function(){})).onCancel((function(){})).onDismiss((function(){})):this.reportTarget=s}}},de=me,ue=(s("c9d9"),Object(v["a"])(de,ce,pe,!1,null,"2065e974",null)),ve=ue.exports;ue.options.components=Object.assign({QMenu:S["u"],QList:S["t"],QItem:S["p"],QItemSection:S["r"]},ue.options.components||{}),ue.options.directives=Object.assign({ClosePopup:S["a"]},ue.options.directives||{});var ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"row justify-end no-wrap",style:{fontSize:e.size}},[s("div",[s("div",{staticClass:"row justify-end items-center q-my-xs"},["killer"===e.$store.state.user.profile.role?s("span",{staticClass:"row items-center"},[e.killerLevel?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/killer-"+e.killerLevel+".png",alt:""}}):e._e(),e.killerType?s("span",{staticClass:"q-mr-xs"},[e._v("\n          "+e._s(e.killerType)+"\n        ")]):e._e()]):e._e(),"admin"===e.$store.state.user.profile.role?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/admin.png",alt:""}}):e._e(),s("span",{staticClass:"text-grey-6"},[e._v(e._s(e.name))])]),s("div",{staticClass:"row no-wrap items-center"},[s("div",{staticClass:"text-no-wrap text-grey-6 q-mr-sm"},[e._v("\n        "+e._s(e.computedTime)+"\n      ")]),s("div",{staticClass:"message q-mr-sm",class:{"is-reply":!!e.reply,"user-role":"user"===e.role,"admin-role":"admin"===e.role,"killer-role":"killer"===e.role}},[e.reply&&e.reply.messageId?s("div",{staticClass:"reply-box row q-pa-md"},[s("img",{staticClass:"avatar q-mr-sm",attrs:{src:e.reply.avatar,alt:""}}),s("div",{staticClass:"col q-mr-sm"},[s("div",{staticClass:"text-bold"},[e._v(e._s(e.reply.name))]),e.reply.text?s("div",{staticClass:"ellipsis-2-lines full-width"},[e._v(e._s(e.reply.text))]):e._e()]),s("div",{staticClass:"img-box"},[e.reply.imgUrl?s("img",{staticClass:"q-mr-xs",attrs:{src:e.reply.imgUrl,alt:""},on:{click:function(t){return e.$emit("handleOpenImgView",{imgURL:e.reply.imgUrl})}}}):e._e()]),e.reply.videoUrl?s("div",{staticClass:"video-box q-mr-xs"},[s("video",{staticClass:"video",attrs:{src:e.reply.videoUrl}}),s("q-icon",{staticClass:"play-icon",attrs:{name:"play_circle_outline"}})],1):e._e()]):e._e(),s("div",{staticClass:"text q-py-sm q-px-md text-pre"},[e._v(e._s(e.text))]),s("q-menu",{attrs:{"touch-position":"","context-menu":""}},[s("q-list",{staticStyle:{"min-width":"100px"}},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",disabled:!e.messageId},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:0})}}},[s("q-item-section",[e._v("\n                收回\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("reply",{avatar:e.avatar,name:e.name,text:e.text,messageId:e.messageId})}}},[s("q-item-section",[e._v("\n                回覆\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""}},[s("q-item-section",{on:{click:function(t){return e.$emit("copy-text",{text:e.text})}}},[e._v("\n                複製\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",disabled:!e.messageId},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:1})}}},[s("q-item-section",[e._v("\n                刪除\n              ")])],1)],1)],1)],1)])])])},fe=[],he={props:{size:{type:String,default:"14px"},avatar:String,text:String,role:{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},"killer-level":{type:Number},"killer-type":{type:String},"user-role":{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},name:{type:String},timestamp:{type:Number},messageId:{type:String},reply:{type:Object}},computed:{computedTime:function(){var e=m["b"].formatDate(this.timestamp,"A hh:mm");return e}}},ye=he,xe=(s("28a6"),Object(v["a"])(ye,ge,fe,!1,null,"67678f8d",null)),qe=xe.exports;xe.options.components=Object.assign({QIcon:S["n"],QMenu:S["u"],QList:S["t"],QItem:S["p"],QItemSection:S["r"]},xe.options.components||{}),xe.options.directives=Object.assign({ClosePopup:S["a"]},xe.options.directives||{});var be=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"row justify-end no-wrap",style:{fontSize:e.size}},[s("div",[s("div",{staticClass:"row justify-end items-center q-my-xs"},["killer"===e.$store.state.user.profile.role?s("span",{staticClass:"row items-center"},[e.killerLevel?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/killer-"+e.killerLevel+".png",alt:""}}):e._e(),e.killerType?s("span",{staticClass:"q-mr-xs"},[e._v("\n          "+e._s(e.killerType)+"\n        ")]):e._e()]):e._e(),"admin"===e.$store.state.user.profile.role?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/admin.png",alt:""}}):e._e(),s("span",{staticClass:"text-grey-6"},[e._v(e._s(e.name))])]),s("div",{staticClass:"row no-wrap items-center"},[s("div",{staticClass:"text-no-wrap text-grey-6 q-mr-sm"},[e._v("\n        "+e._s(e.computedTime)+"\n      ")]),s("div",{staticClass:"text q-px-md q-py-sm",class:{"user-role":"user"===e.$store.state.user.profile.role,"admin-role":"admin"===e.$store.state.user.profile.role,"killer-role":"killer"===e.$store.state.user.profile.role}},[s("img",{staticClass:"img",attrs:{src:e.imgUrl,alt:""},on:{click:function(t){return e.$emit("handleOpenImgView",{imgURL:e.imgUrl})}}}),s("q-menu",{attrs:{"touch-position":"","context-menu":""}},[s("q-list",{staticStyle:{"min-width":"100px"}},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",disabled:!e.messageId},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:0})}}},[s("q-item-section",[e._v("\n                收回\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("reply",{avatar:e.avatar,name:e.name,imgUrl:e.imgUrl,messageId:e.messageId})}}},[s("q-item-section",[e._v("\n                回覆\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",disabled:!e.messageId},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:1})}}},[s("q-item-section",[e._v("\n                刪除\n              ")])],1)],1)],1)],1)])])])},Ce=[],ke={props:{size:{type:String,default:"14px"},avatar:String,imgUrl:String,role:{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},"killer-level":{type:Number},"killer-type":{type:String},"user-role":{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},name:{type:String},timestamp:{type:Number},messageId:{type:String}},computed:{computedTime:function(){var e=m["b"].formatDate(this.timestamp,"A hh:mm");return e}}},_e=ke,we=(s("64af"),Object(v["a"])(_e,be,Ce,!1,null,"40cf91c8",null)),Se=we.exports;we.options.components=Object.assign({QMenu:S["u"],QList:S["t"],QItem:S["p"],QItemSection:S["r"]},we.options.components||{}),we.options.directives=Object.assign({ClosePopup:S["a"]},we.options.directives||{});var $e=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"row justify-end no-wrap",style:{fontSize:e.size}},[s("div",[s("div",{staticClass:"row justify-end items-center q-my-xs"},["killer"===e.$store.state.user.profile.role?s("span",{staticClass:"row items-center"},[e.killerLevel?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/killer-"+e.killerLevel+".png",alt:""}}):e._e(),e.killerType?s("span",{staticClass:"q-mr-xs"},[e._v("\n          "+e._s(e.killerType)+"\n        ")]):e._e()]):e._e(),"admin"===e.$store.state.user.profile.role?s("img",{staticClass:"icon q-mr-xs",attrs:{src:"/statics/chat/admin.png",alt:""}}):e._e(),s("span",{staticClass:"text-grey-6"},[e._v(e._s(e.name))])]),s("div",{staticClass:"row no-wrap items-center"},[s("div",{staticClass:"text-no-wrap text-grey-6 q-mr-sm"},[e._v("\n        "+e._s(e.computedTime)+"\n      ")]),s("div",{staticClass:"text q-px-md q-py-sm",class:{"user-role":"user"===e.$store.state.user.profile.role,"admin-role":"admin"===e.$store.state.user.profile.role,"killer-role":"killer"===e.$store.state.user.profile.role}},[s("video",{staticClass:"video",attrs:{src:e.videoUrl,controls:""}}),s("q-menu",{attrs:{"touch-position":"","context-menu":""}},[s("q-list",{staticStyle:{"min-width":"100px"}},[s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",disabled:!e.messageId},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:0})}}},[s("q-item-section",[e._v("\n                收回\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$emit("reply",{avatar:e.avatar,name:e.name,videoUrl:e.videoUrl,messageId:e.messageId})}}},[s("q-item-section",[e._v("\n                回覆\n              ")])],1),s("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",disabled:!e.messageId},on:{click:function(t){return e.$emit("deleteMessage",{chatName:"public",messageId:e.messageId,deleteAction:1})}}},[s("q-item-section",[e._v("\n                刪除\n              ")])],1)],1)],1)],1)])])])},Ie=[],Oe={props:{size:{type:String,default:"14px"},avatar:String,videoUrl:String,role:{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},"killer-level":{type:Number},"killer-type":{type:String},"user-role":{type:String,default:"user",validator:function(e){return"user"===e||"admin"===e||"killer"===e}},name:{type:String},timestamp:{type:Number},messageId:{type:String}},computed:{computedTime:function(){var e=m["b"].formatDate(this.timestamp,"A hh:mm");return e}}},Re=Oe,Te=(s("3274"),Object(v["a"])(Re,$e,Ie,!1,null,"072b8780",null)),Ne=Te.exports;Te.options.components=Object.assign({QMenu:S["u"],QList:S["t"],QItem:S["p"],QItemSection:S["r"]},Te.options.components||{}),Te.options.directives=Object.assign({ClosePopup:S["a"]},Te.options.directives||{});var De={components:{ChatTime:f,ChatReceivedText:se,ChatReceivedImage:re,ChatReceivedVideo:ve,ChatSentText:qe,ChatSentImage:Se,ChatSentVideo:Ne},data:function(){return{imgView:{isShow:!1,imgURL:"",imgSize:100},isAutoScroll:!0,tipName:"",tipText:"",replyMessageId:"",replyIndex:null,replyAvatar:"",replyName:"",replyText:"",replyImgUrl:"",replyVideoUrl:""}},computed:{computedMessages:function(){return this.$store.state.chat.public.messages},computedReply:function(){return this.$store.state.chat.public.reply}},watch:{computedMessages:function(e){var t=e[e.length-1];this.isAutoScroll||!1!==t.isSent||(this.tipName=t.name,t.isVideo?this.tipText="傳送了影片":t.isImg?this.tipText="傳送了圖片":this.tipText=t.text),t.isSent&&this.scrollToLast(),this.isAutoScroll&&this.scrollToLast()}},methods:{scrollToLast:function(){this.$refs.virtualListRef.scrollTo(this.computedMessages.length-1)},copyText:function(e){var t=e.text,s=this.$refs.copyTextarea;s.value=t,s.select(),s.setSelectionRange(0,99999),document.execCommand("copy"),s.blur()},handleScroll:function(e){var t=e.index,s=e.to;t===s&&(this.tipName="",this.tipText=""),t>=s?this.isAutoScroll=!0:(0===t&&this.getonce(),this.isAutoScroll=!1)},handleReply:function(e){var t=e.avatar,s=e.name,i=e.text,a=void 0===i?"":i,n=e.imgUrl,l=void 0===n?"":n,o=e.videoUrl,r=void 0===o?"":o,c=e.messageId,p={messageId:c,name:s,avatar:t,text:a,imgUrl:l,videoUrl:r};this.$store.dispatch("chat/createReply",{chatName:"public",reply:p})},closeReplyBox:function(){this.$store.dispatch("chat/clearReply",{chatName:"public"})},focusReplyMessage:function(){for(var e=this,t=function(t,s){if(e.computedMessages[t].messageId===e.computedReply.messageId)return e.$refs.virtualListRef.scrollTo(t),setTimeout((function(){e.$refs.virtualListRef.$el.scrollTo({top:document.querySelector(".chat-scroll-box .q-virtual-scroll__content").childNodes[t].offsetTop-e.$refs.virtualListRef.$el.clientHeight/2+document.querySelector(".chat-scroll-box .q-virtual-scroll__content").childNodes[t].clientHeight/2}),e.$store.dispatch("chat/setReplyIndex",{chatName:"public",index:t})}),100),"break"},s=0,i=this.computedMessages.length;s<i;s+=1){var a=t(s,i);if("break"===a)break}setTimeout((function(){e.$store.dispatch("chat/setReplyIndex",{chatName:"public",index:null})}),1e3)},handleOpenImgView:function(e){var t=e.imgURL;this.imgView.imgURL=t,this.imgView.isShow=!0},getonce:function(){var e=this,t=this.$database.ref("/chat_public"),s=this.$store.state.chat["public"],i=s.firstMessageTime,a=s.messageSize;t.endAt(i).orderByChild("createTime/_seconds").limitToLast(a).once("value",(function(t){var s=[],a=[];t.forEach((function(e){a.push(e.val()),s.push(e.val().createTime._seconds)})),e.$store.dispatch("chat/setFirstMessageTime",{chatName:"public",firstMessageTime:0===s.length?i:s[0]-1}),e.$store.dispatch("chat/pushMessages",{chatName:"public",messages:a}),e.$refs.virtualListRef.scrollTo(a.length)}))},deleteMessage:function(e){var t=this,s=e.chatName,i=e.messageId,a=e.deleteAction;1===a&&this.$q.dialog({title:"聊運彩",message:"確定要刪除訊息嗎? 他人仍然可以看到這個訊息。",cancel:!0,persistent:!0}).onOk((function(){t.$store.dispatch("chat/deleteMessage",{chatName:s,messageId:i,deleteAction:1})})).onCancel((function(){})).onDismiss((function(){})),0===a&&this.$q.dialog({title:"聊運彩",message:"確定要收回訊息嗎? 這訊息大家都無法查看。",cancel:!0,persistent:!0}).onOk((function(){t.$store.dispatch("chat/deleteMessage",{chatName:s,messageId:i,deleteAction:0})})).onCancel((function(){})).onDismiss((function(){})),-1===a&&this.$q.dialog({title:"聊運彩",message:"確定要移除留言嗎?",cancel:!0,persistent:!0}).onOk((function(){t.$store.dispatch("chat/deleteMessage",{chatName:s,messageId:i,deleteAction:-1})})).onCancel((function(){})).onDismiss((function(){}))},handleMutedUser:function(e){var t=this,s=e.uid;this.$axiosInstance.post("/admin/muted",{uid:s}).then((function(){t.$q.dialog({title:"提示",message:"凍結玩家成功"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))})).catch((function(){t.$q.dialog({title:"提示",message:"凍結玩家失敗"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}))}},mounted:function(){var e=this,t=this.$database.ref("/chat_public");t.orderByChild("createTime/_seconds").limitToLast(this.$store.state.chat["public"].messageSize).once("value",(function(s){var i=[],a=[];s.forEach((function(e){a.push(e.val()),i.push(e.val().createTime._seconds)})),e.$store.dispatch("chat/setFirstMessageTime",{chatName:"public",firstMessageTime:i[0]-1}),e.$store.dispatch("chat/pushMessages",{chatName:"public",messages:a}),setTimeout((function(){e.$refs.virtualListRef.scrollTo(e.computedMessages.length)}),0),t.orderByChild("createTime/_seconds").limitToLast(1).on("child_added",(function(t){e.$store.dispatch("chat/checkNewMessage",{chatName:"public",newMessage:t.val()})})),t.orderByChild("createTime/_seconds").on("child_changed",(function(e){console.log("update message"),console.log(e.key,e.val())}))}))},destroyed:function(){clearInterval(this._interval),this.$store.dispatch("chat/clearMessages",{chatName:"public"})}},Ue=De,Le=(s("80d6"),Object(v["a"])(Ue,o,r,!1,null,"f62b5f9c",null)),Me=Le.exports;Le.options.components=Object.assign({QVirtualScroll:S["B"],QBadge:S["b"],QBtn:S["c"],QIcon:S["n"],QDialog:S["j"],QSpace:S["y"]},Le.options.components||{}),Le.options.directives=Object.assign({ClosePopup:S["a"]},Le.options.directives||{});var Pe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"send-box row items-center q-py-sm page-padding"},[s("chat-upload-file",{staticClass:"q-mr-sm",attrs:{multiple:"",handleAddUploadFile:e.handleAddUploadFile}}),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],ref:"textArea",staticClass:"text-area col",attrs:{rows:e.textAreaRows,placeholder:"輸入文字"},domProps:{value:e.message},on:{input:[function(t){t.target.composing||(e.message=t.target.value)},e.handleInputSendBox]}}),s("q-btn",{staticClass:"btn q-ml-sm rotate-315",attrs:{color:"white",dense:"",round:"",flat:"",icon:"send"},on:{click:e.handleSubmit}})],1)])},Ae=[],je=(s("4917"),{data:function(){return{textAreaRows:1,message:""}},components:{ChatUploadFile:I},watch:{textAreaRows:function(){this.$refs.textArea.scrollTop=this.$refs.textArea.scrollHeight}},methods:{handleSubmit:function(){var e=this,t=this.$store.state.user.profile,s=t.name,i=t.role,a=t.killerLevel,n=t.killerType,l=t.avatar,o=t.signature,r=t.point;if(0!==this.message.trim().length){var c={messageId:"",tempHash:Object(b["a"])(),isSent:!0,name:s,role:i,killerLevel:a,killerType:n,avatar:l,signature:o,point:r,text:this.message,timestamp:(new Date).getTime()};this.$store.dispatch("chat/addMessage",{chatName:"public",message:c}).then((function(){e.$store.dispatch("chat/clearReply",{chatName:"public"})})),this.message="",this.changeInputSendBoxRows()}else this.$q.dialog({title:"訊息",message:"請輸入文字!"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))},changeInputSendBoxRows:function(){var e=this.message.match(/(\r\n)|(\n)/g);e?(e.length<3&&(this.textAreaRows=e.length+1),e.length>=3&&(this.textAreaRows=4,this.$refs.textArea.scrollTop=this.$refs.textArea.scrollHeight)):this.textAreaRows=1},handleInputSendBox:function(e){this.changeInputSendBoxRows()},handleAddUploadFile:function(e){var t=this,s=e.file,i=this.$store.state.user.profile,a=i.name,n=i.role,l=i.killerLevel,o=i.killerType,r=i.avatar,c=i.signature,p=i.point;if(/^image/.test(s.type)){if(s.size>=4e6)return void this.$q.dialog({title:"上傳檔案",message:"上傳圖片 ".concat(s.name," 失敗，大小必須在 4 mb 以下")}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}));var m=new FileReader;m.onload=function(e){var i=t.$firebase.storage().ref(),m=(new Date).getTime()+Object(b["a"])(),d=s.type.split("/")[s.type.split("/").length-1],u=i.child("chat/public/".concat(t.$store.state.user.profile.uid,"/").concat(m,".").concat(d));u.put(s).then((function(i){u.getDownloadURL().then((function(i){var m={messageId:"",tempHash:Object(b["a"])(),isSent:!0,name:a,role:n,killerLevel:l,killerType:o,avatar:r,signature:c,point:p,timestamp:(new Date).getTime(),file:e.target.result,fileType:s.type,fileName:s.name,isImg:!0,imgUrl:i};t.$store.dispatch("chat/addMessage",{chatName:"public",message:m})}))}))},m.readAsDataURL(s)}if(/^video/.test(s.type)){if(s.size>=5e7)return void this.$q.dialog({title:"上傳檔案",message:"上傳影音 ".concat(s.name," 失敗，大小必須在 50 mb 以下")}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}));var d=new FileReader;d.onload=function(e){var i=t.$firebase.storage().ref(),m=(new Date).getTime()+Object(b["a"])(),d=s.type.split("/")[s.type.split("/").length-1],u=i.child("chat/public/".concat(t.$store.state.user.profile.uid,"/").concat(m,".").concat(d));u.put(s).then((function(i){u.getDownloadURL().then((function(i){var m={messageId:"",tempHash:Object(b["a"])(),isSent:!0,name:a,role:n,killerLevel:l,killerType:o,avatar:r,signature:c,point:p,timestamp:(new Date).getTime(),file:e.target.result,fileType:s.type,fileName:s.name,isVideo:!0,videoUrl:i};t.$store.dispatch("chat/addMessage",{chatName:"public",message:m})}))}))},d.readAsDataURL(s)}}}}),Qe=je,ze=(s("3ff5"),Object(v["a"])(Qe,Pe,Ae,!1,null,"b1600502",null)),Ve=ze.exports;ze.options.components=Object.assign({QBtn:S["c"]},ze.options.components||{});var Be={components:{ChatMessageBox:Me,ChatSendBox:Ve}},Fe=Be,Ee=Object(v["a"])(Fe,n,l,!1,null,"36dcf798",null),He=Ee.exports,Je={preFetch:function(e){e.store,e.currentRoute,e.previousRoute,e.redirect,e.ssrContext},name:"PageIndex",components:{HomeChat:He}},Ye=Je,Ge=Object(v["a"])(Ye,i,a,!1,null,null,null);t["default"]=Ge.exports;Ge.options.components=Object.assign({QPage:S["v"]},Ge.options.components||{})},aa3b:function(e,t,s){},ad51:function(e,t,s){},bad5:function(e,t,s){},c0a83:function(e,t,s){"use strict";var i=s("e0f2"),a=s.n(i);a.a},c156:function(e,t,s){"use strict";var i=s("4c20"),a=s.n(i);a.a},c344:function(e,t,s){},c950:function(e,t,s){"use strict";var i=s("bad5"),a=s.n(i);a.a},c9d9:function(e,t,s){"use strict";var i=s("821f"),a=s.n(i);a.a},deb6:function(e,t,s){"use strict";var i=s("078c"),a=s.n(i);a.a},e0f2:function(e,t,s){},e3ec:function(e,t,s){},fe2c:function(e,t,s){"use strict";var i=s("3c7c"),a=s.n(i);a.a}}]);