(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["7ac6929a"],{1138:function(t,e,n){},"2ff9":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container page-padding"},[n("app-title",{attrs:{text:"會員資料"}}),n("div",{staticClass:"text-center q-mb-lg"},[n("app-profile-avatar",{staticClass:"q-mb-sm",attrs:{avatar:t.avatar},on:{changeAvatar:function(e){var n=e.newAvatar;return t.avatar=n},changeAvatarUrl:function(e){var n=e.newAvatarUrl;return t.avatarUrl=n}}}),n("div",{staticClass:"text-h6 text-grey-7"},[t._v("\n      "+t._s(t.$store.state.user.profile.name)+"\n    ")])],1),n("div",[n("q-form",{staticClass:"q-gutter-md q-pb-xl",on:{submit:t.onSubmit}},[n("q-input",{attrs:{label:"姓名 (必填)",outlined:"",rules:[function(t){return!!t||"姓名欄位必填!"}]},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"person"}})]},proxy:!0}]),model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),n("q-input",{attrs:{label:"暱稱 (必填)",outlined:"",rules:[function(t){return!!t||"暱稱欄位必填!"},function(t){return t.length<=10||"不可超過 10 字!"},t.checkNickname]},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"person"}})]},proxy:!0}]),model:{value:t.nickname,callback:function(e){t.nickname=e},expression:"nickname"}}),n("q-input",{attrs:{label:"手機號碼 (必填)",outlined:"",rules:[function(t){return!!t||"手機號碼欄位必填!"},t.checkPhoneNumber]},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"local_phone"}})]},proxy:!0}]),model:{value:t.phoneNumber,callback:function(e){t.phoneNumber=e},expression:"phoneNumber"}}),n("q-input",{attrs:{type:"email",label:"信箱帳號 (必填)",outlined:"",rules:[function(t){return!!t||"信箱帳號欄位必填!"},t.checkMail]},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"mail"}})]},proxy:!0}]),model:{value:t.mail,callback:function(e){t.mail=e},expression:"mail"}}),n("q-input",{attrs:{label:"生日",outlined:"",mask:"date",rules:[]},scopedSlots:t._u([{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[n("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[n("q-date",{on:{input:function(){return t.$refs.qDateProxy.hide()}},model:{value:t.birthday,callback:function(e){t.birthday=e},expression:"birthday"}})],1)],1)]},proxy:!0}]),model:{value:t.birthday,callback:function(e){t.birthday=e},expression:"birthday"}}),n("q-input",{staticClass:"q-pb-md",attrs:{outlined:"",label:t.$store.state.user.profile.inviteCode?"已填過邀請代碼":"填入邀請代碼",disable:!!t.$store.state.user.profile.inviteCode},model:{value:t.inviteCode,callback:function(e){t.inviteCode=e},expression:"inviteCode"}}),n("q-input",{attrs:{autogrow:"",outlined:"",label:"簽名檔 (限20字)",rules:[function(t){return t.length<=20||"不可超過 20 字!"}]},model:{value:t.signature,callback:function(e){t.signature=e},expression:"signature"}}),n("div",{staticClass:"text-center"},[n("q-btn",{attrs:{label:"確認送出",type:"submit",color:"primary"}})],1)],1)],1)],1)},i=[],r=(n("551c"),n("06db"),n("7f7f"),n("11ec")),s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"title row items-center text-weight-bold"},[n("router-link",{staticClass:"link-unstyle row items-center",attrs:{to:t.to}},[n("q-icon",{attrs:{name:"arrow_back_ios"}})],1),n("span",[t._v(t._s(t.text))])],1)},o=[],c={props:{text:{type:String},to:{type:String,default:"/"}}},u=c,l=(n("bfd9"),n("2877")),p=n("fe09"),d=Object(l["a"])(u,s,o,!1,null,"fe30d6f6",null),f=d.exports;d.options.components=Object.assign({QIcon:p["l"]},d.options.components||{});var m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"profile-avatar relative-position"},[n("img",{staticClass:"img absolute-center",attrs:{src:t.computedAvatar,alt:""}}),n("div",{staticClass:"edit-btn absolute-bottom text-center cursor-pointer text-weight-bold",on:{click:t.handleChangeAvatar}},[t._v("\n    編輯 "),n("q-icon",{attrs:{name:"edit"}})],1),n("input",{ref:"imageUpload",staticClass:"hidden",attrs:{type:"file",capture:"",accept:"image/*"},on:{change:t.handleFileUpload}})])},h=[],v=(n("28a5"),n("1732")),b={props:{avatar:{type:String,default:"/statics/default-profile-avatar.jpg"}},computed:{computedAvatar:function(){return this.avatar||"/statics/default-profile-avatar.jpg"}},methods:{handleChangeAvatar:function(){this.$refs.imageUpload.click()},handleFileUpload:function(t){var e=this,n=t.target.files;if(n&&n[0]){var a=n[0];if(a.size>=4e6)return void this.$q.dialog({title:"上傳檔案",message:"上傳圖片 ".concat(a.name," 失敗，大小必須在 4 mb 以下")}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}));this.$emit("changeAvatar",{newAvatar:window.URL.createObjectURL(a)});var i=this.$firebase.storage().ref(),r=(new Date).getTime()+Object(v["a"])(),s=a.type.split("/")[a.type.split("/").length-1],o=i.child("avatar/".concat(this.$store.state.user.profile.uid,"/").concat(r,".").concat(s));o.put(a).then((function(t){o.getDownloadURL().then((function(t){console.log(t),e.$emit("changeAvatarUrl",{newAvatarUrl:t})}))}))}}}},g=b,k=(n("7d1a"),Object(l["a"])(g,m,h,!1,null,"be27d242",null)),y=k.exports;k.options.components=Object.assign({QIcon:p["l"]},k.options.components||{});var x={name:"PageProfile",components:{AppTitle:f,AppProfileAvatar:y},data:function(){var t=this.$store.state.user.profile,e=t.name,n=t.nickname,a=t.phoneNumber,i=t.mail,r=t.birthday,s=t.inviteCode,o=t.signature,c=t.avatar;return{avatar:c,avatarUrl:"",name:e,nickname:n,phoneNumber:a,mail:i,birthday:r,inviteCode:s||this.$route.query.invite_code,signature:o}},methods:{onSubmit:function(){var t=this,e=this.avatar,n=this.avatarUrl,a=this.name,i=this.nickname,s=this.phoneNumber,o=this.mail,c=this.birthday,u=this.inviteCode,l=this.signature,p={avatar:n||e,name:a,displayName:i,phone:s,email:o,birthday:c,signature:l,refCode:u};this.$axiosInstance.post("/user/modifyUserProfile",{data:p}).then((function(){var e=Object(r["a"])(!0,{},t.$store.state.user.profile,p);t.$store.dispatch("user/setProfile",e)})).catch((function(){t.$q.dialog({title:"更新資料",message:"更新失敗!"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}))},checkNickname:function(t){var e=this,n=this.$store.state.user.profile.nickname;return new Promise((function(a,i){if(t===n)return a(!0);e.$axiosInstance.get("/user/checkUnique",{data:{type:"uniqueName",value:t}}).then((function(t){var e=t.data,n=e.success,i=e.isExist;return n&&i?void a(!0):a("此暱稱已有人使用過")})).catch((function(){return a("此暱稱已有人使用過")}))}))},checkMail:function(t){var e=this,n=this.$store.state.user.profile.mail;return new Promise((function(a,i){if(t===n)return a(!0);e.$axiosInstance.get("/user/checkUnique",{data:{type:"uniqueEmail",value:t}}).then((function(t){var e=t.data,n=e.success,i=e.isExist;return n&&i?void a(!0):a("此信箱已有人使用過")})).catch((function(){return a("此信箱已有人使用過")}))}))},checkPhoneNumber:function(t){var e=this,n=this.$store.state.user.profile.phoneNumber;return new Promise((function(a,i){if(t===n)return a(!0);e.$axiosInstance.get("/user/checkUnique",{data:{type:"uniquePhone",value:t}}).then((function(t){var e=t.data,n=e.success,i=e.isExist;return n&&i?void a(!0):a("此電話已有人使用過")})).catch((function(){return a("此電話已有人使用過")}))}))}}},q=x,C=Object(l["a"])(q,a,i,!1,null,null,null);e["default"]=C.exports;C.options.components=Object.assign({QForm:p["j"],QInput:p["m"],QIcon:p["l"],QPopupProxy:p["v"],QDate:p["g"],QBtn:p["c"]},C.options.components||{})},"3c60":function(t,e,n){},"7d1a":function(t,e,n){"use strict";var a=n("3c60"),i=n.n(a);i.a},bfd9:function(t,e,n){"use strict";var a=n("1138"),i=n.n(a);i.a}}]);