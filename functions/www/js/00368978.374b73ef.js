(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["00368978"],{"0589":function(t,e,n){"use strict";var a=n("564e"),i=n.n(a);i.a},"0885":function(t,e,n){"use strict";var a=n("8336"),i=n.n(a);i.a},"26e8":function(t,e,n){"use strict";var a=n("d70a"),i=n.n(a);i.a},"2ff9":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container page-padding"},[n("app-title",{attrs:{text:"會員資料"}}),n("div",{staticClass:"row items-center q-pl-md q-mb-lg"},[n("app-profile-avatar",{staticClass:"q-mr-md",attrs:{avatar:t.avatar},on:{changeAvatar:function(e){var n=e.newAvatar;return t.avatar=n},changeAvatarUrl:function(e){var n=e.newAvatarUrl;return t.avatarUrl=n}}}),n("span",{staticClass:"text-bold text-grey-7",staticStyle:{"font-size":"18px"}},[n("div",{staticClass:"q-pl-sm q-pb-xs",attrs:{clickable:""}},[t._v("\n        "+t._s(t.$store.state.user.profile.nickname)+"\n      ")]),n("div",["killer"===t.$store.state.user.profile.role?n("q-btn-dropdown",{staticClass:"select q-pl-md q-py-none",attrs:{dense:"",rounded:"",unelevated:"","menu-anchor":"bottom left","menu-self":"top left","dropdown-icon":"r_arrow_drop_down","content-style":"border-radius: 10px;margin-top: 3px;"},scopedSlots:t._u([{key:"label",fn:function(){return[n("div",{staticClass:"row items-center no-wrap"},[n("q-icon",{attrs:{left:"",name:"img:statics/killer-"+t.selectDefault.rank+".png"}}),n("div",{staticClass:"text-center"},[t._v("\n                "+t._s(t.$store.state.user.rankMap[t.selectDefault.rank].name)+" : "+t._s(t.selectDefault.league)+"\n              ")])],1)]},proxy:!0}],null,!1,3719860865)},[n("q-list",{staticClass:"menu"},t._l(t.$store.state.user.profile.titles,(function(e,a){return n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:"titles-"+a,staticClass:"select-level",attrs:{clickable:"",focused:t.selectDefault.rank===e.rank},on:{click:function(n){return t.onDefaultClick({rank:e.rank,league:e.league,sport:e.sport})}}},[n("q-item-section",[n("span",{staticClass:"row items-center"},[n("img",{staticClass:"level-icon q-mr-sm",attrs:{src:"/statics/chat/killer-"+e.rank+".png",alt:""}}),t._v("\n                  "+t._s(t.$store.state.user.rankMap[e.rank]&&t.$store.state.user.rankMap[e.rank].name)+" : \n                  "+t._s(e.league)+"\n                ")])])],1)})),1)],1):t._e()],1)])],1),n("div",[n("q-form",{staticClass:"q-gutter-xs q-pb-xl"},[n("q-input",{attrs:{label:"姓名 (必填)",outlined:"",disable:!!t.$store.state.user.profile.name,rules:[function(t){return!!t||"姓名欄位必填!"}]},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"person"}})]},proxy:!0}]),model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),n("q-input",{attrs:{label:"暱稱 (必填)",outlined:"",disable:!!t.$store.state.user.profile.nickname,rules:[function(t){return!!t||"暱稱欄位必填!"},function(t){return t.length<=10||"不可超過 10 字!"}]},on:{blur:t.checkNickname},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"person"}})]},proxy:!0}]),model:{value:t.nickname,callback:function(e){t.nickname=e},expression:"nickname"}}),n("q-input",{attrs:{label:"手機號碼 (必填)",outlined:"",hint:"例:09########",disable:!!t.$store.state.user.profile.phoneNumber,rules:[function(t){return!!t||"手機號碼欄位必填!"}]},on:{blur:t.checkPhoneNumber},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"local_phone"}})]},proxy:!0}]),model:{value:t.phoneNumber,callback:function(e){t.phoneNumber=e},expression:"phoneNumber"}}),n("q-input",{attrs:{type:"email",label:"信箱帳號 (必填)",outlined:"",disable:!!t.$store.state.user.profile.mail,rules:[function(t){return!!t||"信箱帳號欄位必填!"}]},on:{blur:t.checkMail},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"mail"}})]},proxy:!0}]),model:{value:t.mail,callback:function(e){t.mail=e},expression:"mail"}}),n("q-input",{attrs:{label:"生日(必填)",outlined:"",mask:"date",disable:!!t.$store.state.user.profile.birthday,rules:[function(t){return!!t||"生日欄位必填!"}]},scopedSlots:t._u([{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[n("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[n("q-date",{attrs:{locale:t.myLocale},on:{input:function(){return t.$refs.qDateProxy.hide()}},model:{value:t.birthday,callback:function(e){t.birthday=e},expression:"birthday"}})],1)],1)]},proxy:!0}]),model:{value:t.birthday,callback:function(e){t.birthday=e},expression:"birthday"}}),n("q-input",{staticClass:"q-pb-md",attrs:{outlined:"",label:t.$store.state.user.profile.inviteCode?"已填過邀請代碼":"填入邀請代碼",disable:!!t.$store.state.user.profile.inviteCode},model:{value:t.inviteCode,callback:function(e){t.inviteCode=e},expression:"inviteCode"}}),n("q-input",{attrs:{autogrow:"",outlined:"",label:"簽名檔 (限20字)",rules:[function(t){return t.length<=20||"不可超過 20 字!"}]},model:{value:t.signature,callback:function(e){t.signature=e},expression:"signature"}}),n("div",{staticClass:"text-center"},[n("q-btn",{attrs:{label:"確認送出",color:"primary"},on:{click:t.onSubmit}}),n("app-dialog-point",{attrs:{point:t.refPoint},model:{value:t.isOpenPointDialog,callback:function(e){t.isOpenPointDialog=e},expression:"isOpenPointDialog"}})],1)],1)],1)],1)},i=[],s=(n("8e6e"),n("8a81"),n("ac6a"),n("cadf"),n("06db"),n("456d"),n("c47a")),o=n.n(s),r=(n("28a5"),n("7f7f"),n("11ec")),c=n("bd4c"),l=n("70ad"),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"profile-avatar relative-position"},[n("img",{staticClass:"img absolute-center",attrs:{src:t.computedAvatar,alt:""}}),n("div",{staticClass:"edit-btn absolute-bottom text-center cursor-pointer text-weight-bold",on:{click:t.handleChangeAvatar}},[t._v("\n    編輯 "),n("q-icon",{attrs:{name:"edit"}})],1),n("input",{ref:"imageUpload",staticClass:"hidden",attrs:{type:"file",accept:"image/*"},on:{change:t.handleFileUpload}})])},p=[],f=n("1732"),d={props:{avatar:{type:String,default:"/statics/default-profile-avatar.jpg"}},computed:{computedAvatar:function(){return this.avatar||"/statics/default-profile-avatar.jpg"}},methods:{handleChangeAvatar:function(){this.$refs.imageUpload.click()},handleFileUpload:function(t){var e=this,n=t.target.files;if(n&&n[0]){var a=n[0];if(a.size>=4e6)return void this.$q.dialog({title:"上傳檔案",message:"上傳圖片 ".concat(a.name," 失敗，大小必須在 4 mb 以下")}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}));this.$emit("changeAvatar",{newAvatar:window.URL.createObjectURL(a)});var i=this.$firebase.storage().ref(),s=(new Date).getTime()+Object(f["a"])(),o=a.type.split("/")[a.type.split("/").length-1],r=i.child("avatar/".concat(this.$store.state.user.profile.uid,"/").concat(s,".").concat(o));r.put(a).then((function(t){r.getDownloadURL().then((function(t){e.$emit("changeAvatarUrl",{newAvatarUrl:t})}))}))}}}},m=d,h=(n("0885"),n("2877")),v=n("fe09"),b=Object(h["a"])(m,u,p,!1,null,"1dffdb46",null),g=b.exports;b.options.components=Object.assign({QIcon:v["n"]},b.options.components||{});var k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-dialog",{ref:"dialog",on:{hide:function(e){return t.$emit("hide",!1)}}},[n("q-card",{staticClass:"card container relative-position"},[n("q-card-section",{staticClass:"q-px-xl q-py-lg"},[n("div",{staticClass:"bg"},[n("img",{staticClass:"ribbon-1",attrs:{src:"/statics/ribbon-1.png",alt:""}}),n("img",{staticClass:"ribbon-2",attrs:{src:"/statics/ribbon-2.png",alt:""}})]),n("div",{staticClass:"title text-bold text-white"},[t._v("\n        邀請代碼活動\n      ")]),n("div",{staticClass:"point-text row items-end text-bold"},[n("span",[t._v("獲得")]),n("span",{staticClass:"point q-mx-md"},[t._v(t._s(t.point))]),n("span",[t._v("點數")])])])],1)],1)},y=[],q=(n("c5f6"),{model:{prop:"isOpen",event:"hide"},props:{isOpen:Boolean,point:{type:Number,default:200}},watch:{isOpen:function(t){t?this.$refs.dialog.show():this.$router.push({path:"/"})}}}),C=q,$=(n("0589"),Object(h["a"])(C,k,y,!1,null,"85736f66",null)),x=$.exports;function D(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function O(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?D(n,!0).forEach((function(e){o()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D(n).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}$.options.components=Object.assign({QDialog:v["j"],QCard:v["e"],QCardSection:v["f"]},$.options.components||{});var w={name:"PageProfile",components:{AppTitle:l["a"],AppProfileAvatar:g,AppDialogPoint:x},data:function(){return this.getData()},watch:{"$store.state.user.profile":function(){var t=this.getData(),e=t.avatar,n=t.birthday,a=t.inviteCode,i=t.mail,s=t.name,o=t.nickname,r=t.phoneNumber,c=t.signature,l=void 0===c?"":c;this.avatar=e,this.birthday=n,this.inviteCode=a,this.mail=i,s&&(this.name=s),o&&(this.nickname=o),r&&(this.phoneNumber=r),this.signature=l}},methods:{onSubmit:function(){var t=this,e=this.avatar,n=this.avatarUrl,a=this.name,i=this.nickname,s=this.phoneNumber,o=this.mail,c=this.birthday,l=this.inviteCode,u=this.signature,p=void 0===u?"":u,f=this.selectDefault,d={},m=this.$store.state.user.profile.status;d.avatar=e,n&&(d.avatar=n),a&&(d.name=a),i&&(d.displayName=i),s&&(10===s.length?d.phone="+886"+s.substr(1,9):d.phone=s),o&&(d.email=o),this.$store.state.user.profile.birthday||(d.birthday=new Date(c).getTime()),p&&(d.signature=p),l&&(d.refCode=l),f.rank&&(d.title={rank:f.rank,league:f.league,sport:f.sport}),null===d.avatar&&(d.avatar="https://firebasestorage.googleapis.com/v0/b/sport19y0715.appspot.com/o/default%2Favatar%2Fdefault-profile-avatar.jpg?alt=media&token=7753385f-5457-4fe2-af8e-acef75fcccd8"),this.$axiosInstance.post("/user/modifyUserProfile",d).then((function(e){d.status=e.data.data.status,d.defaultTitle=d.title,delete d.title,d.phoneNumber=d.phone,delete d.phone,d.referrer=e.data.data.data.referrer;var n=Object(r["a"])(!0,{},t.$store.state.user.profile,d);n.birthday=n.birthday/1e3,t.$store.dispatch("user/setProfile",n),localStorage.removeItem("invite_code"),t.$q.dialog({title:0===m?"會員新增資料完成":"更新資料",message:0===m?"歡迎使用聊運彩":"會員更新資料完成"}).onOk((function(){e.data.refPoint?(t.refPoint=e.data.refPoint,t.isOpenPointDialog=!0):t.$router.push({path:"/"})})).onCancel((function(){})).onDismiss((function(){}))})).catch((function(){t.$q.dialog({title:"更新資料",message:"更新失敗!"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}))},getData:function(){var t=this.$store.state.user.profile,e=t.name,n=t.nickname,a=t.phoneNumber,i=t.mail,s=t.birthday,o=t.signature,r=void 0===o?"":o,l=t.avatar,u="";return u=this.$store.state.user.profile.inviteCode?this.$store.state.user.profile.inviteCode:this.$route.query["invite_code"]?this.$route.query["invite_code"]:localStorage.getItem("invite_code"),{refPoint:0,avatar:l,avatarUrl:"",name:e,nickname:n,phoneNumber:a||this.$firebase.auth().currentUser.phoneNumber,mail:i||this.$firebase.auth().currentUser.email,birthday:c["b"].formatDate(s,"YYYY/MM/DD")||"1990/01/01",myLocale:{days:"星期日,星期一,星期二,星期三,星期四,星期五,星期六".split(","),daysShort:"週日,週一,週二,週三,週四,週五,週六".split(","),months:"一月,二月,三月,四月,五月,六月,七月,八月,九月,十月,十一月,十二月".split(","),monthsShort:"一月,二月,三月,四月,五月,六月,七月,八月,九月,十月,十一月,十二月".split(","),firstDayOfWeek:1},inviteCode:u,signature:r,isOpenPointDialog:!1,selectDefault:O({},this.$store.state.user.profile.defaultTitle)}},onDefaultClick:function(t){var e=t.rank,n=t.league,a=t.sport;this.selectDefault.rank=e,this.selectDefault.league=n,this.selectDefault.sport=a},checkNickname:function(){var t=this,e=this.nickname,n=this.$store.state.user.profile.nickname;e!==n&&this.$axiosInstance.post("/user/checkUnique",{type:"uniqueName",value:e}).then((function(e){var n=e.data,a=n.success,i=n.isExist;a?i&&t.$q.dialog({title:"驗證",message:"此暱稱已有人使用過"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){})):t.$q.dialog({title:"驗證",message:"此暱稱已有人使用過"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))})).catch((function(){t.$q.dialog({title:"驗證",message:"此暱稱已有人使用過"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}))},checkMail:function(){var t=this,e=this.mail,n=this.$store.state.user.profile.mail;e!==n&&this.$axiosInstance.post("/user/checkUnique",{type:"uniqueEmail",value:e}).then((function(e){var n=e.data,a=n.success,i=n.isExist;a?i&&t.$q.dialog({title:"驗證",message:"此信箱已有人使用過"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){})):t.$q.dialog({title:"驗證",message:"此信箱已有人使用過"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))})).catch((function(){t.$q.dialog({title:"驗證",message:"此信箱已有人使用過"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}))},checkPhoneNumber:function(){var t=this,e=this.phoneNumber,n=this.$store.state.user.profile.phoneNumber;e!==n&&this.$axiosInstance.post("/user/checkUnique",{type:"uniquePhone",value:"+886"+e.substr(1,9)}).then((function(e){var n=e.data,a=n.success,i=n.isExist;a?i&&t.$q.dialog({title:"驗證",message:"此電話已有人使用過"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){})):t.$q.dialog({title:"驗證",message:"此電話已有人使用過"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))})).catch((function(){t.$q.dialog({title:"驗證",message:"此電話已有人使用過"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}))}}},_=w,P=(n("26e8"),Object(h["a"])(_,a,i,!1,null,"4e8823dc",null));e["default"]=P.exports;P.options.components=Object.assign({QBtnDropdown:v["d"],QIcon:v["n"],QList:v["t"],QItem:v["p"],QItemSection:v["r"],QForm:v["l"],QInput:v["o"],QPopupProxy:v["x"],QDate:v["i"],QBtn:v["c"]},P.options.components||{}),P.options.directives=Object.assign({ClosePopup:v["a"]},P.options.directives||{})},4434:function(t,e,n){"use strict";var a=n("8ddc"),i=n.n(a);i.a},"564e":function(t,e,n){},"70ad":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"title row items-center text-weight-bold"},[n("router-link",{staticClass:"link-unstyle row items-center",attrs:{to:t.to}},[n("q-icon",{staticClass:"text-bold",attrs:{name:"arrow_back_ios"}})],1),n("span",[t._v(t._s(t.text))])],1)},i=[],s={props:{text:{type:String},to:{type:String,default:"/"}}},o=s,r=(n("4434"),n("2877")),c=n("fe09"),l=Object(r["a"])(o,a,i,!1,null,"2c3e120b",null);e["a"]=l.exports;l.options.components=Object.assign({QIcon:c["n"]},l.options.components||{})},8336:function(t,e,n){},"8ddc":function(t,e,n){},d70a:function(t,e,n){}}]);