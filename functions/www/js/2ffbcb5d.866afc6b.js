(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2ffbcb5d"],{"0885":function(t,e,n){"use strict";var a=n("8336"),i=n.n(a);i.a},"2ff9":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container page-padding"},[n("app-title",{attrs:{text:"會員資料"}}),n("div",{staticClass:"text-center q-mb-lg"},[n("app-profile-avatar",{staticClass:"q-mb-sm",attrs:{avatar:t.avatar},on:{changeAvatar:function(e){var n=e.newAvatar;return t.avatar=n},changeAvatarUrl:function(e){var n=e.newAvatarUrl;return t.avatarUrl=n}}}),n("div",{staticClass:"text-h6 text-grey-7"},[t._v("\n      "+t._s(t.$store.state.user.profile.name)+"\n    ")])],1),n("div",[n("q-form",{staticClass:"q-gutter-md q-pb-xl"},[n("q-input",{attrs:{label:"姓名 (必填)",outlined:"",rules:[function(t){return!!t||"姓名欄位必填!"}]},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"person"}})]},proxy:!0}]),model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),n("q-input",{attrs:{label:"暱稱 (必填)",outlined:"",rules:[function(t){return!!t||"暱稱欄位必填!"},function(t){return t.length<=10||"不可超過 10 字!"},t.checkNickname]},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"person"}})]},proxy:!0}]),model:{value:t.nickname,callback:function(e){t.nickname=e},expression:"nickname"}}),n("q-input",{attrs:{label:"手機號碼 (必填)",outlined:"",rules:[function(t){return!!t||"手機號碼欄位必填!"},t.checkPhoneNumber]},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"local_phone"}})]},proxy:!0}]),model:{value:t.phoneNumber,callback:function(e){t.phoneNumber=e},expression:"phoneNumber"}}),n("q-input",{attrs:{type:"email",label:"信箱帳號 (必填)",outlined:"",rules:[function(t){return!!t||"信箱帳號欄位必填!"},t.checkMail]},scopedSlots:t._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"mail"}})]},proxy:!0}]),model:{value:t.mail,callback:function(e){t.mail=e},expression:"mail"}}),n("q-input",{attrs:{label:"生日",outlined:"",mask:"date",rules:[]},scopedSlots:t._u([{key:"append",fn:function(){return[n("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[n("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[n("q-date",{attrs:{locale:t.myLocale},on:{input:function(){return t.$refs.qDateProxy.hide()}},model:{value:t.birthday,callback:function(e){t.birthday=e},expression:"birthday"}})],1)],1)]},proxy:!0}]),model:{value:t.birthday,callback:function(e){t.birthday=e},expression:"birthday"}}),n("q-input",{staticClass:"q-pb-md",attrs:{outlined:"",label:t.$store.state.user.profile.inviteCode?"已填過邀請代碼":"填入邀請代碼",disable:!!t.$store.state.user.profile.inviteCode},model:{value:t.inviteCode,callback:function(e){t.inviteCode=e},expression:"inviteCode"}}),n("q-input",{attrs:{autogrow:"",outlined:"",label:"簽名檔 (限20字)",rules:[function(t){return t.length<=20||"不可超過 20 字!"}]},model:{value:t.signature,callback:function(e){t.signature=e},expression:"signature"}}),n("div",{staticClass:"text-center"},[n("q-btn",{attrs:{label:"確認送出",color:"primary"},on:{click:t.onSubmit}})],1)],1)],1)],1)},i=[],r=(n("551c"),n("06db"),n("28a5"),n("7f7f"),n("11ec")),s=n("70ad"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"profile-avatar relative-position"},[n("img",{staticClass:"img absolute-center",attrs:{src:t.computedAvatar,alt:""}}),n("div",{staticClass:"edit-btn absolute-bottom text-center cursor-pointer text-weight-bold",on:{click:t.handleChangeAvatar}},[t._v("\n    編輯 "),n("q-icon",{attrs:{name:"edit"}})],1),n("input",{ref:"imageUpload",staticClass:"hidden",attrs:{type:"file",accept:"image/*"},on:{change:t.handleFileUpload}})])},c=[],u=n("1732"),l={props:{avatar:{type:String,default:"/statics/default-profile-avatar.jpg"}},computed:{computedAvatar:function(){return this.avatar||"/statics/default-profile-avatar.jpg"}},methods:{handleChangeAvatar:function(){this.$refs.imageUpload.click()},handleFileUpload:function(t){var e=this,n=t.target.files;if(n&&n[0]){var a=n[0];if(a.size>=4e6)return void this.$q.dialog({title:"上傳檔案",message:"上傳圖片 ".concat(a.name," 失敗，大小必須在 4 mb 以下")}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}));this.$emit("changeAvatar",{newAvatar:window.URL.createObjectURL(a)});var i=this.$firebase.storage().ref(),r=(new Date).getTime()+Object(u["a"])(),s=a.type.split("/")[a.type.split("/").length-1],o=i.child("avatar/".concat(this.$store.state.user.profile.uid,"/").concat(r,".").concat(s));o.put(a).then((function(t){o.getDownloadURL().then((function(t){e.$emit("changeAvatarUrl",{newAvatarUrl:t})}))}))}}}},p=l,d=(n("0885"),n("2877")),f=n("fe09"),h=Object(d["a"])(p,o,c,!1,null,"1dffdb46",null),m=h.exports;h.options.components=Object.assign({QIcon:f["n"]},h.options.components||{});var v={name:"PageProfile",components:{AppTitle:s["a"],AppProfileAvatar:m},data:function(){return this.getData()},watch:{"$store.state.user.profile":function(){var t=this.getData(),e=t.avatar,n=t.birthday,a=t.inviteCode,i=t.mail,r=t.name,s=t.nickname,o=t.phoneNumber,c=t.signature,u=void 0===c?"":c;this.avatar=e,this.birthday=n,this.inviteCode=a,this.mail=i,r&&(this.name=r),s&&(this.nickname=s),o&&(this.phoneNumber=o),this.signature=u}},methods:{onSubmit:function(){var t=this,e=this.avatar,n=this.avatarUrl,a=this.name,i=this.nickname,s=this.phoneNumber,o=this.mail,c=this.birthday,u=this.inviteCode,l=this.signature,p=void 0===l?"":l,d={};(n||e)&&(d.avatar=e),a&&(d.name=a),i&&(d.dispatch=i),s&&(d.phone=s),o&&(d.email=o),c&&(d.birthday=c),p&&(d.signature=p),u&&(d.refCode=u),this.$axiosInstance.post("/user/modifyUserProfile",d).then((function(){var e=Object(r["a"])(!0,{},t.$store.state.user.profile,d);t.$store.dispatch("user/setProfile",e),localStorage.removeItem("invite_code")})).catch((function(){t.$q.dialog({title:"更新資料",message:"更新失敗!"}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){}))}))},getData:function(){var t=this.$store.state.user.profile,e=t.name,n=t.nickname,a=t.phoneNumber,i=t.mail,r=t.birthday,s=t.signature,o=void 0===s?"":s,c=t.avatar,u="";return u=this.$store.state.user.profile.inviteCode?this.$store.state.user.profile.inviteCode:this.$route.query["invite_code"]?this.$route.query["invite_code"]:localStorage.getItem("invite_code"),{avatar:c,avatarUrl:"",name:e,nickname:n,phoneNumber:a,mail:i,birthday:r||"1990/01/01",myLocale:{days:"星期日,星期一,星期二,星期三,星期四,星期五,星期六".split(","),daysShort:"日,一,二,三,四,五,六".split(","),months:"一月,二月,三月,四月,五月,六月,七月,八月,九月,十月,十一月,十二月".split(","),monthsShort:"一月,二月,三月,四月,五月,六月,七月,八月,九月,十月,十一月,十二月".split(","),firstDayOfWeek:1},inviteCode:u,signature:o}},checkNickname:function(t){var e=this,n=this.$store.state.user.profile.nickname;return new Promise((function(a,i){if(t===n)return a(!0);e.$axiosInstance.post("/user/checkUnique",{type:"uniqueName",value:t}).then((function(t){var e=t.data,n=e.success,i=e.isExist;return n?i?a("此暱稱已有人使用過"):void a(!0):a("此暱稱已有人使用過")})).catch((function(){return a("此暱稱已有人使用過")}))}))},checkMail:function(t){var e=this,n=this.$store.state.user.profile.mail;return new Promise((function(a,i){if(t===n)return a(!0);e.$axiosInstance.post("/user/checkUnique",{type:"uniqueEmail",value:t}).then((function(t){var e=t.data,n=e.success,i=e.isExist;return n?i?a("此信箱已有人使用過"):void a(!0):a("此信箱已有人使用過")})).catch((function(){return a("此信箱已有人使用過")}))}))},checkPhoneNumber:function(t){var e=this,n=this.$store.state.user.profile.phoneNumber;return new Promise((function(a,i){if(t===n)return a(!0);e.$axiosInstance.post("/user/checkUnique",{type:"uniquePhone",value:t}).then((function(t){var e=t.data,n=e.success,i=e.isExist;return n?i?a("此電話已有人使用過"):void a(!0):a("此電話已有人使用過")})).catch((function(){return a("此電話已有人使用過")}))}))}},mounted:function(){this.$route.query["invite_code"]&&this.$route.query["invite_code"]!==this.$store.state.user.profile.code&&localStorage.setItem("invite_code",this.$route.query["invite_code"])}},b=v,g=Object(d["a"])(b,a,i,!1,null,null,null);e["default"]=g.exports;g.options.components=Object.assign({QForm:f["l"],QInput:f["o"],QIcon:f["n"],QPopupProxy:f["x"],QDate:f["i"],QBtn:f["c"]},g.options.components||{})},4434:function(t,e,n){"use strict";var a=n("8ddc"),i=n.n(a);i.a},"70ad":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"title row items-center text-weight-bold"},[n("router-link",{staticClass:"link-unstyle row items-center",attrs:{to:t.to}},[n("q-icon",{staticClass:"text-bold",attrs:{name:"arrow_back_ios"}})],1),n("span",[t._v(t._s(t.text))])],1)},i=[],r={props:{text:{type:String},to:{type:String,default:"/"}}},s=r,o=(n("4434"),n("2877")),c=n("fe09"),u=Object(o["a"])(s,a,i,!1,null,"2c3e120b",null);e["a"]=u.exports;u.options.components=Object.assign({QIcon:c["n"]},u.options.components||{})},8336:function(t,e,n){},"8ddc":function(t,e,n){}}]);